var Rt=Object.defineProperty;var Kt=(i,e,t)=>e in i?Rt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var f=(i,e,t)=>(Kt(i,typeof e!="symbol"?e+"":e,t),t);import{e as Ye,r as re,m as Xe,i as Pt,w as Ct,a as Mt,b as le,c as Ze,t as xt,h as St,g as Ot,o as Dt,n as Et,d as At,f as Q,j as Nt,k as Tt,l as Ft,u as Ht,p as He,q as zt,V as jt,s as qt,v as Lt,x as Wt}from"./winbox-DszNCYmb.js";import{r as Bt}from"./advanced-chat-B527sa3p.js";const Ut={install(i){i.config.globalProperties.$env=window.SupportChat,i.provide("env",window.SupportChat)}};var Qt=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let et;const ue=i=>et=i,tt=Symbol();function Me(i){return i&&typeof i=="object"&&Object.prototype.toString.call(i)==="[object Object]"&&typeof i.toJSON!="function"}var ne;(function(i){i.direct="direct",i.patchObject="patch object",i.patchFunction="patch function"})(ne||(ne={}));function Jt(){const i=Ye(!0),e=i.run(()=>re({}));let t=[],s=[];const r=Xe({install(n){ue(r),r._a=n,n.provide(tt,r),n.config.globalProperties.$pinia=r,s.forEach(o=>t.push(o)),s=[]},use(n){return!this._a&&!Qt?s.push(n):t.push(n),this},_p:t,_a:null,_e:i,_s:new Map,state:e});return r}const st=()=>{};function ze(i,e,t,s=st){i.push(e);const r=()=>{const n=i.indexOf(e);n>-1&&(i.splice(n,1),s())};return!t&&Ot()&&Dt(r),r}function B(i,...e){i.slice().forEach(t=>{t(...e)})}const Vt=i=>i();function xe(i,e){i instanceof Map&&e instanceof Map&&e.forEach((t,s)=>i.set(s,t)),i instanceof Set&&e instanceof Set&&e.forEach(i.add,i);for(const t in e){if(!e.hasOwnProperty(t))continue;const s=e[t],r=i[t];Me(r)&&Me(s)&&i.hasOwnProperty(t)&&!le(s)&&!Ze(s)?i[t]=xe(r,s):i[t]=s}return i}const kt=Symbol();function Gt(i){return!Me(i)||!i.hasOwnProperty(kt)}const{assign:q}=Object;function Yt(i){return!!(le(i)&&i.effect)}function Xt(i,e,t,s){const{state:r,actions:n,getters:o}=e,a=t.state.value[i];let h;function c(){a||(t.state.value[i]=r?r():{});const u=At(t.state.value[i]);return q(u,n,Object.keys(o||{}).reduce((d,I)=>(d[I]=Xe(Q(()=>{ue(t);const m=t._s.get(i);return o[I].call(m,m)})),d),{}))}return h=it(i,c,e,t,s,!0),h}function it(i,e,t={},s,r,n){let o;const a=q({actions:{}},t),h={deep:!0};let c,u,d=[],I=[],m;const l=s.state.value[i];!n&&!l&&(s.state.value[i]={}),re({});let g;function Fe(_){let $;c=u=!1,typeof _=="function"?(_(s.state.value[i]),$={type:ne.patchFunction,storeId:i,events:m}):(xe(s.state.value[i],_),$={type:ne.patchObject,payload:_,storeId:i,events:m});const N=g=Symbol();Et().then(()=>{g===N&&(c=!0)}),u=!0,B(d,$,s.state.value[i])}const $t=n?function(){const{state:$}=t,N=$?$():{};this.$patch(L=>{q(L,N)})}:st;function wt(){o.stop(),d=[],I=[],s._s.delete(i)}function bt(_,$){return function(){ue(s);const N=Array.from(arguments),L=[],G=[];function _t(O){L.push(O)}function It(O){G.push(O)}B(I,{args:N,name:_,store:A,after:_t,onError:It});let Y;try{Y=$.apply(this&&this.$id===i?this:A,N)}catch(O){throw B(G,O),O}return Y instanceof Promise?Y.then(O=>(B(L,O),O)).catch(O=>(B(G,O),Promise.reject(O))):(B(L,Y),Y)}}const vt={_p:s,$id:i,$onAction:ze.bind(null,I),$patch:Fe,$reset:$t,$subscribe(_,$={}){const N=ze(d,_,$.detached,()=>L()),L=o.run(()=>Ct(()=>s.state.value[i],G=>{($.flush==="sync"?u:c)&&_({storeId:i,type:ne.direct,events:m},G)},q({},h,$)));return N},$dispose:wt},A=Mt(vt);s._s.set(i,A);const k=(s._a&&s._a.runWithContext||Vt)(()=>s._e.run(()=>(o=Ye()).run(e)));for(const _ in k){const $=k[_];if(le($)&&!Yt($)||Ze($))n||(l&&Gt($)&&(le($)?$.value=l[_]:xe($,l[_])),s.state.value[i][_]=$);else if(typeof $=="function"){const N=bt(_,$);k[_]=N,a.actions[_]=$}}return q(A,k),q(xt(A),k),Object.defineProperty(A,"$state",{get:()=>s.state.value[i],set:_=>{Fe($=>{q($,_)})}}),s._p.forEach(_=>{q(A,o.run(()=>_({store:A,app:s._a,pinia:s,options:a})))}),l&&n&&t.hydrate&&t.hydrate(A.$state,l),c=!0,u=!0,A}function Zt(i,e,t){let s,r;const n=typeof e=="function";typeof i=="string"?(s=i,r=n?t:e):(r=i,s=i.id);function o(a,h){const c=St();return a=a||(c?Pt(tt,null):null),a&&ue(a),a=et,a._s.has(s)||(n?it(s,e,r,a):Xt(s,r,a)),a._s.get(s)}return o.$id=s,o}function es(i,e,t){switch(t){case">":return i>e;case">=":return i>=e;case"<":return i<e;case"<=":return i<=e;case"=":return i===e;case"!=":return i!==e;default:return i===e}}function Se(i){return i==null}function w(i){return Array.isArray(i)}function $e(i){return typeof i=="function"}function X(i){return ts(i)===0}function ts(i){return w(i)?i.length:Object.keys(i).length}function ss(i,e,t,s="SORT_REGULAR"){let r=-1;const n=i.map(o=>({criteria:e.map(h=>typeof h=="function"?h(o):o[h]),index:++r,value:o}));return is(n,(o,a)=>rs(o,a,t,s))}function is(i,e){let t=i.length;i.sort(e);const s=[];for(;t--;)s[t]=i[t].value;return s}function rs(i,e,t,s){let r=-1;const n=i.criteria,o=e.criteria,a=n.length;for(;++r<a;){const h=ns(n[r],o[r],s);if(h){const c=t[r];return h*(c==="desc"?-1:1)}}return i.index-e.index}function ns(i,e,t){if(i!==e){const s=i!==void 0,r=i===null,n=i===i,o=e!==void 0,a=e===null;return(typeof i!="number"||typeof e!="number")&&(i=String(i),e=String(e),t==="SORT_FLAG_CASE"&&(i=i.toUpperCase(),e=e.toUpperCase())),!a&&i>e||r&&o||!s||!n?1:-1}return 0}function os(i,e){return i.reduce((t,s)=>{const r=e(s);return t[r]===void 0&&(t[r]=[]),t[r].push(s),t},{})}function de(i){throw new Error(["[Pinia ORM]"].concat(i).join(" "))}function oe(i,e){i||de(e)}function as(i,e){let t="",s=i;for(;s--;)t+=e[Math.random()*64|0];return t}function hs(i,e){const s=JSON.stringify(e?{key:i,params:e}:{key:i});return typeof process>"u"?btoa(s):s}function Oe(i,e){if(i===e)return!0;if(i instanceof Date&&e instanceof Date)return i.getTime()===e.getTime();if(!i||!e||typeof i!="object"&&typeof e!="object")return i===e;if(i.prototype!==e.prototype)return!1;const t=Object.keys(i);return t.length!==Object.keys(e).length?!1:t.every(s=>Oe(i[s],e[s]))}class cs{constructor(e,t={},s={}){if(!e||typeof e!="string")throw new Error(`Expected a string key for Entity, but found ${e}.`);const{idAttribute:r="id",mergeStrategy:n=(a,h)=>({...a,...h}),processStrategy:o=a=>({...a})}=s;this._key=e,this._getId=r,this._mergeStrategy=n,this._processStrategy=o,this.define(t)}get key(){return this._key}define(e){this.schema=Object.keys(e).reduce((t,s)=>{const r=e[s];return{...t,[s]:r}},this.schema||{})}getId(e,t,s){return this._getId(e,t,s)}merge(e,t){return this._mergeStrategy(e,t)}normalize(e,t,s,r,n,o){const a=this.getId(e,t,s),h=this.key;if(h in o||(o[h]={}),a in o[h]||(o[h][a]=[]),o[h][a].includes(e))return a;o[h][a].push(e);const c=this._processStrategy(e,t,s);return Object.keys(this.schema).forEach(u=>{if(c.hasOwnProperty(u)&&typeof c[u]=="object"){const d=this.schema[u],I=typeof d=="function"?d(e):d;c[u]=r(c[u],c,u,I,n,o)}}),n(this,c,e,t,s),a}}class rt{constructor(e,t){t&&(this._schemaAttribute=typeof t=="string"?s=>s[t]:t),this.define(e)}get isSingleSchema(){return!this._schemaAttribute}define(e){this.schema=e}getSchemaAttribute(e,t,s){return!this.isSingleSchema&&this._schemaAttribute(e,t,s)}inferSchema(e,t,s){if(this.isSingleSchema)return this.schema;const r=this.getSchemaAttribute(e,t,s);return this.schema[r]}normalizeValue(e,t,s,r,n,o){const a=this.inferSchema(e,t,s);if(!a)return e;const h=r(e,t,s,a,n,o);return this.isSingleSchema||h===void 0||h===null?h:{id:h,schema:this.getSchemaAttribute(e,t,s)}}}class ls extends rt{constructor(e,t){if(!t)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');super(e,t)}normalize(e,t,s,r,n,o){return this.normalizeValue(e,t,s,r,n,o)}}const us=i=>{if(Array.isArray(i)&&i.length>1)throw new Error(`Expected schema definition to be a single schema, but found ${i.length}.`);return i[0]},nt=i=>Array.isArray(i)?i:Object.keys(i).map(e=>i[e]),ds=(i,e,t,s,r,n,o)=>nt(e).map(a=>r(a,t,s,us(i),n,o));class fs extends rt{normalize(e,t,s,r,n,o){return nt(e).map(a=>this.normalizeValue(a,t,s,r,n,o)).filter(a=>a!=null)}}const ps=(i,e,t,s,r,n,o)=>{const a={...e};return Object.keys(i).forEach(h=>{const c=i[h],u=typeof c=="function"?c(e):c,d=r(e[h],e,h,u,n,o);d==null?delete a[h]:a[h]=d}),a},De=(i,e,t,s,r,n)=>typeof i!="object"||!i?i:typeof s=="object"&&(!s.normalize||typeof s.normalize!="function")?(Array.isArray(s)?ds:ps)(s,i,e,t,De,r,n):s.normalize(i,e,t,De,r,n),ys=i=>(e,t,s,r,n)=>{const o=e.key,a=e.getId(s,r,n);o in i||(i[o]={}),i[o][a]=i[o][a]?e.merge(i[o][a],t):t},we={Array:fs,Entity:cs,Union:ls},ms=(i,e)=>{if(!i||typeof i!="object")throw new Error(`Unexpected input given to normalize. Expected type to be "object", found "${i===null?"null":typeof i}".`);const t={},s=ys(t),n=De(i,i,null,e,s,{});return{entities:t,result:n}};var gs=Object.defineProperty,$s=(i,e,t)=>e in i?gs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Te=(i,e,t)=>($s(i,typeof e!="symbol"?e+"":e,t),t);class ot{constructor(e){Te(this,"$parameters",{}),this.$self().attributes=e,this.$parameters={...this.$parameters,...this.$self().parameters}}get(e){return e}set(e){return e}static withParameters(e){return this.parameters=e,this}getParameters(){return this.$parameters}$self(){return this.constructor}static newRawInstance(e){return new this(e)}}Te(ot,"attributes");Te(ot,"parameters");var ws=Object.defineProperty,bs=(i,e,t)=>e in i?ws(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,je=(i,e,t)=>(bs(i,typeof e!="symbol"?e+"":e,t),t);class at{constructor(e){je(this,"model"),je(this,"key"),this.model=e,this.key=""}setKey(e){return this.key=e,this}}var vs=Object.defineProperty,_s=(i,e,t)=>e in i?vs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,be=(i,e,t)=>(_s(i,typeof e!="symbol"?e+"":e,t),t);class R extends at{constructor(e,t){super(e),be(this,"parent"),be(this,"related"),be(this,"onDeleteMode"),this.parent=e,this.related=t}getRelated(){return this.related}getKeys(e,t){return e.map(s=>s[t])}onDelete(e){return this.onDeleteMode=e,this}mapToDictionary(e,t){return e.reduce((s,r)=>{const[n,o]=t(r);return s[n]||(s[n]=[]),s[n].push(o),s},{})}compositeKeyMapper(e,t,s){w(e)&&w(t)?e.forEach((r,n)=>{s(r,t[n])}):!w(t)&&!w(e)?s(e,t):de(["This relation cant be resolve. Either child or parent doesnt have different key types (composite)",JSON.stringify(e),JSON.stringify(t)])}getKey(e){return w(e)?`[${e.join(",")}]`:e}}var Is=Object.defineProperty,Rs=(i,e,t)=>e in i?Is(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Z=(i,e,t)=>(Rs(i,typeof e!="symbol"?e+"":e,t),t);class Ee extends R{constructor(e,t,s,r,n){super(e,e),Z(this,"relatedModels"),Z(this,"relatedTypes"),Z(this,"morphId"),Z(this,"morphType"),Z(this,"ownerKey"),this.relatedModels=t,this.relatedTypes=this.createRelatedTypes(t),this.morphId=s,this.morphType=r,this.ownerKey=n}createRelatedTypes(e){return e.reduce((t,s)=>(t[s.$entity()]=s,t),{})}getType(){return this.morphType}getRelateds(){return this.relatedModels}define(e){return e.union(this.relatedModels,(t,s,r)=>{const n=s[this.morphType],o=this.relatedTypes[n],a=this.ownerKey||o.$getKeyName();return s[this.morphId]=t[a],n})}attach(e,t){}addEagerConstraints(e,t){}match(e,t,s){const r=this.buildDictionary(s,t);t.forEach(n=>{var c;const o=n[this.morphType],a=n[this.morphId],h=((c=r[o])==null?void 0:c[a])??null;n.$setRelation(e,h)})}make(e,t){return!e||!t?null:this.relatedTypes[t].$newInstance(e)}buildDictionary(e,t){const s=this.getKeysByEntity(t),r={};for(const n in s){const o=this.relatedTypes[n];oe(!!o,[`Trying to load "morph to" relation of \`${n}\``,"but the model could not be found."]);const a=this.ownerKey||o.$getKeyName(),h=e.newQueryWithConstraints(n).whereIn(a,s[n]).get(!1);r[n]=h.reduce((c,u)=>(c[u[a]]=u,c),{})}return r}getKeysByEntity(e){return e.reduce((t,s)=>{const r=s[this.morphType],n=s[this.morphId];return n!==null&&this.relatedTypes[r]!==void 0&&(t[r]||(t[r]=[]),t[r].push(n)),t},{})}}var Ks=Object.defineProperty,Ps=(i,e,t)=>e in i?Ks(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,qe=(i,e,t)=>(Ps(i,typeof e!="symbol"?e+"":e,t),t);class he extends at{constructor(e,t=null){super(e),qe(this,"value"),qe(this,"isNullable",!0),this.value=typeof t=="function"?t():t}notNullable(){return this.isNullable=!1,this}makeReturn(e,t){return t===void 0?this.value:t===null?(this.isNullable||this.throwWarning(["is set as non nullable!"]),t):(typeof t!==e&&this.throwWarning([t,"is not a",e]),t)}throwWarning(e){console.warn(["[Pinia ORM]"].concat([`Field ${this.model.$entity()}:${this.key} - `,...e]).join(" "))}}var Cs=Object.defineProperty,Ms=(i,e,t)=>e in i?Cs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ve=(i,e,t)=>(Ms(i,typeof e!="symbol"?e+"":e,t),t);let ht=class extends he{constructor(e,t={}){super(e),ve(this,"options"),ve(this,"alphabet","useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"),ve(this,"size",21),this.options=typeof t=="number"?{size:t}:t,this.alphabet=this.options.alphabet??this.alphabet,this.size=this.options.size??this.size}make(e){const t=this.model.$casts()[this.model.$getKeyName()];return t?e??t.withParameters(this.options).newRawInstance(this.model.$fields()).set(e):e??as(this.size,this.alphabet)}};var xs=Object.defineProperty,Ss=(i,e,t)=>e in i?xs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Le=(i,e,t)=>(Ss(i,typeof e!="symbol"?e+"":e,t),t);class Os{constructor(e){Le(this,"schemas",{}),Le(this,"model"),this.model=e}one(e,t){e=e||this.model,t=t||this.model;const s=`${e.$entity()}${t.$entity()}`;if(this.schemas[s])return this.schemas[s];const r=this.newEntity(e,t);this.schemas[s]=r;const n=this.definition(e);return r.define(n),r}many(e,t){return new we.Array(this.one(e,t))}union(e,t){const s=e.reduce((r,n)=>(r[n.$entity()]=this.one(n),r),{});return new we.Union(s,t)}newEntity(e,t){const s=e.$entity(),r=this.idAttribute(e,t);return new we.Entity(s,{},{idAttribute:r})}idAttribute(e,t){const s=this.getUidPrimaryKeyPairs(e);return(r,n,o)=>{var h,c,u;o!==null&&((h=t.$fields()[o])==null||h.attach(n,r));for(const d in s)Se(r[d])&&(r[d]=s[d].setKey(d).make(r[d]));return["BelongsTo","HasOne","MorphOne","MorphTo"].includes(((c=t.$fields()[o])==null?void 0:c.constructor.name)??"")&&w(n[o])&&de(['You are passing a list to "',`${t.$entity()}.${o}`,`" which is a one to one Relation(${(u=t.$fields()[o])==null?void 0:u.constructor.name}):`,JSON.stringify(n[o])]),e.$getIndexId(r)}}getUidPrimaryKeyPairs(e){const t=e.$fields(),s=e.$getKeyName(),r=w(s)?s:[s],n={};return r.forEach(o=>{const a=t[o];a instanceof ht&&(n[o]=a)}),n}definition(e){const t=e.$fields(),s={};for(const r in t){const n=t[r];n instanceof R&&(s[r]=n.define(this))}return s}}var Ds=Object.defineProperty,Es=(i,e,t)=>e in i?Ds(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,As=(i,e,t)=>(Es(i,e+"",t),t);class Ns{constructor(e){As(this,"model"),this.model=e}process(e){const t=this.normalize(e);return[e,t]}normalize(e){const t=w(e)?[this.getSchema()]:this.getSchema();return ms(e,t).entities}getSchema(){return new Os(this.model).one()}}function Ts(i){return{save(e,t=!0){Object.assign(this.data,e),t&&i&&i.newQuery(this.$id).save(Object.values(e))},insert(e,t=!0){Object.assign(this.data,e),t&&i&&i.newQuery(this.$id).insert(Object.values(e))},update(e,t=!0){Object.assign(this.data,e),t&&i&&i.newQuery(this.$id).update(Object.values(e))},fresh(e,t=!0){this.data=e,t&&i&&i.newQuery(this.$id).fresh(Object.values(e))},destroy(e,t=!0){t&&i?i.newQuery(this.$id).newQuery(this.$id).destroy(e):e.forEach(s=>delete this.data[s])},delete(e,t=!0){t&&i?i.whereId(e).delete():e.forEach(s=>delete this.data[s])},flush(e,t=!0){this.data={},t&&i&&i.newQuery(this.$id).flush()}}}function ct(i,e,t){return Zt(i,{state:()=>({data:{}}),actions:Ts(t),...e})}var Fs=Object.defineProperty,Hs=(i,e,t)=>e in i?Fs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,U=(i,e,t)=>(Hs(i,typeof e!="symbol"?e+"":e,t),t);let lt=class extends R{constructor(e,t,s,r,n,o,a){super(e,t),U(this,"pivot"),U(this,"foreignPivotKey"),U(this,"relatedPivotKey"),U(this,"parentKey"),U(this,"relatedKey"),U(this,"pivotKey","pivot"),this.pivot=s,this.foreignPivotKey=r,this.relatedPivotKey=n,this.parentKey=o,this.relatedKey=a}getRelateds(){return[this.related,this.pivot]}define(e){return e.many(this.related,this.parent)}attach(e,t){const s=t.pivot??{};s[this.foreignPivotKey]=e[this.parentKey],s[this.relatedPivotKey]=t[this.relatedKey],t[`pivot_${this.pivot.$entity()}`]=s}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}match(e,t,s){const r=s.get(!1),n=s.newQuery(this.pivot.$entity()).whereIn(this.relatedPivotKey,this.getKeys(r,this.relatedKey)).whereIn(this.foreignPivotKey,this.getKeys(t,this.parentKey)).groupBy(this.foreignPivotKey,this.relatedPivotKey).get();t.forEach(o=>{const a=[];r.forEach(h=>{var d;const c=((d=n[`[${o[this.parentKey]},${h[this.relatedKey]}]`])==null?void 0:d[0])??null,u=h.$newInstance(h.$toJson());u.$setRelation("pivot",c),c&&a.push(u)}),o.$setRelation(e,a)})}addEagerConstraints(e,t){}};var zs=Object.defineProperty,js=(i,e,t)=>e in i?zs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,P=(i,e,t)=>(js(i,typeof e!="symbol"?e+"":e,t),t);class ae{constructor(e,t,s,r,n){P(this,"database"),P(this,"model"),P(this,"wheres",[]),P(this,"orders",[]),P(this,"groups",[]),P(this,"take",null),P(this,"skip",0),P(this,"visible",["*"]),P(this,"hidden",[]),P(this,"cache"),P(this,"eagerLoad",{}),P(this,"pinia"),P(this,"fromCache",!1),P(this,"cacheConfig",{}),P(this,"getNewHydrated",!1),P(this,"hydratedDataCache"),this.database=e,this.model=t,this.pinia=n,this.cache=s,this.hydratedDataCache=r,this.getNewHydrated=!1}newQuery(e){return this.getNewHydrated=!0,new ae(this.database,this.database.getModel(e),this.cache,this.hydratedDataCache,this.pinia)}newQueryWithConstraints(e){const t=new ae(this.database,this.database.getModel(e),this.cache,this.hydratedDataCache,this.pinia);return t.eagerLoad={...this.eagerLoad},t.wheres=[...this.wheres],t.orders=[...this.orders],t.take=this.take,t.skip=this.skip,t.fromCache=this.fromCache,t.cacheConfig=this.cacheConfig,t}newQueryForRelation(e){return new ae(this.database,e.getRelated(),this.cache,new Map,this.pinia)}newInterpreter(){return new Ns(this.model)}commit(e,t){const s=ct(this.model.$storeName(),this.model.$piniaOptions(),this)(this.pinia);return e&&typeof s[e]=="function"&&s[e](t,!1),this.cache&&["get","all","insert","flush","delete","update","destroy"].includes(e)&&this.cache.clear(),s.$state.data}withMeta(){return this.makeVisible(["_meta"])}makeVisible(e){return this.visible=e,this.getNewHydrated=!0,this}makeHidden(e){return this.hidden=e,this.getNewHydrated=!0,this}where(e,t){return this.wheres.push({field:e,value:t,boolean:"and"}),this}whereIn(e,t){return t instanceof Set&&(t=Array.from(t)),this.wheres.push({field:e,value:t,boolean:"and"}),this}whereId(e){return this.where(this.model.$getKeyName(),e)}orWhere(e,t){return this.wheres.push({field:e,value:t,boolean:"or"}),this}whereHas(e,t=()=>{},s,r){return this.where(this.getFieldWhereForRelations(e,t,s,r))}orWhereHas(e,t=()=>{},s,r){return this.orWhere(this.getFieldWhereForRelations(e,t,s,r))}has(e,t,s){return this.where(this.getFieldWhereForRelations(e,()=>{},t,s))}orHas(e,t,s){return this.orWhere(this.getFieldWhereForRelations(e,()=>{},t,s))}doesntHave(e){return this.where(this.getFieldWhereForRelations(e,()=>{},"=",0))}orDoesntHave(e){return this.orWhere(this.getFieldWhereForRelations(e,()=>{},"=",0))}whereDoesntHave(e,t=()=>{}){return this.where(this.getFieldWhereForRelations(e,t,"=",0))}orWhereDoesntHave(e,t=()=>{}){return this.orWhere(this.getFieldWhereForRelations(e,t,"=",0))}groupBy(...e){return e.forEach(t=>{this.groups.push({field:t})}),this}orderBy(e,t="asc"){return this.orders.push({field:e,direction:t}),this}limit(e){return this.take=e,this}offset(e){return this.skip=e,this}with(e,t=()=>{}){return this.getNewHydrated=!0,this.eagerLoad[e]=t,this}withAll(e=()=>{}){let t=this.model.$fields();Object.values(this.model.$types()).forEach(r=>{t={...t,...r.fields()}});for(const r in t)t[r]instanceof R&&this.with(r,e);return this}withAllRecursive(e=3){return this.withAll(t=>{e>0&&t.withAllRecursive(e-1)})}useCache(e,t){return this.fromCache=!0,this.cacheConfig={key:e,params:t},this}getFieldWhereForRelations(e,t=()=>{},s,r){const n=this.newQuery(this.model.$entity()).with(e,t).get(!1).filter(o=>es(w(o[e])?o[e].length:o[e]===null?0:1,typeof s=="number"?s:r??1,typeof s=="number"||r===void 0?">=":s)).map(o=>o.$getIndexId());return o=>n.includes(o.$getIndexId())}storeFind(e=[]){const t=this.commit("all"),s=[],r=new Set(e);return r.size>0?r.forEach(n=>{t[n]&&s.push(this.hydrate(t[n],{visible:this.visible,hidden:this.hidden,operation:"get"}))}):Object.values(t).forEach(n=>s.push(this.hydrate(n,{visible:this.visible,hidden:this.hidden,operation:"get"}))),s}all(){return this.storeFind()}get(e=!0){if(!this.fromCache||!this.cache)return this.internalGet(e);const t=this.cacheConfig.key?this.cacheConfig.key+JSON.stringify(this.cacheConfig.params):hs(this.model.$entity(),{where:this.wheres,groups:this.groups,orders:this.orders,eagerLoads:this.eagerLoad,skip:this.skip,take:this.take,hidden:this.hidden,visible:this.visible}),s=this.cache.get(t);if(s)return s;const r=this.internalGet(e);return this.cache.set(t,r),r}internalGet(e){this.model.$entity()!==this.model.$baseEntity()&&this.where(this.model.$typeKey(),this.model.$fields()[this.model.$typeKey()].make());const t=this.select();return X(t)||this.eagerLoadRelations(t),e&&t.forEach(s=>s.$self().retrieved(s)),this.groups.length>0?this.filterGroup(t):t}first(){return this.limit(1).get()[0]??null}find(e){return this.whereId(e)[w(e)?"get":"first"]()}select(){let e=[];const t=this.wheres,s=this.wheres.findIndex(n=>n.field===this.model.$getKeyName());if(s>-1){const n=this.wheres[s].value;e=(($e(n)?[]:w(n)?n:[n])||[]).map(String)||[],e.length>0&&(this.wheres=[...this.wheres.slice(0,s),...this.wheres.slice(s+1)])}let r=this.storeFind(e);return r=this.filterWhere(r),r=this.filterOrder(r),r=this.filterLimit(r),this.wheres=t,r}filterWhere(e){if(X(this.wheres))return e;const t=this.getWhereComparator();return e.filter(s=>t(s))}getWhereComparator(){const{and:e,or:t}=os(this.wheres,s=>s.boolean);return s=>{const r=[];return e&&r.push(e.every(n=>this.whereComparator(s,n))),t&&r.push(t.some(n=>this.whereComparator(s,n))),r.includes(!0)}}whereComparator(e,t){return $e(t.field)?t.field(e):w(t.value)?t.value.includes(e[t.field]):$e(t.value)?t.value(e[t.field]):e[t.field]===t.value}filterOrder(e){if(this.orders.length===0)return e;const t=this.orders.map(r=>r.field),s=this.orders.map(r=>r.direction);return ss(e,t,s)}filterGroup(e){const t={},s=this.groups.map(r=>r.field);return e.forEach(r=>{const n=s.length===1?r[s[0]]:`[${s.map(o=>r[o]).toString()}]`;t[n]=(t[n]||[]).concat(r)}),t}filterLimit(e){return this.take!==null?e.slice(this.skip,this.skip+this.take):e.slice(this.skip)}load(e){this.eagerLoadRelations(e)}eagerLoadRelations(e){for(const t in this.eagerLoad)this.eagerLoadRelation(e,t,this.eagerLoad[t])}eagerLoadRelation(e,t,s){const r=this.getRelation(t),n=this.newQueryForRelation(r);r.addEagerConstraints(n,e),s(n),r.match(t,e,n)}getRelation(e){return this.model.$getRelation(e)}revive(e){return w(e)?this.reviveMany(e):this.reviveOne(e)}reviveOne(e){this.getNewHydrated=!1;const t=this.model.$getIndexId(e),s=this.commit("get")[t]??null;if(!s)return null;const r=this.hydrate(s,{visible:this.visible,hidden:this.hidden,operation:"get"});return this.reviveRelations(r,e),r}reviveMany(e){return e.reduce((t,s)=>{const r=this.reviveOne(s);return r&&t.push(r),t},[])}reviveRelations(e,t){const s=this.model.$fields();for(const r in t){const n=s[r];if(!(n instanceof R))continue;const o=t[r];if(!o)return;if(n instanceof Ee){const a=e[n.getType()];e[r]=this.newQuery(a).reviveOne(o);continue}e[r]=w(o)?this.newQueryForRelation(n).reviveMany(o):this.newQueryForRelation(n).reviveOne(o)}}new(e=!0){let t=this.hydrate({},{operation:e?"set":"get"});const s=t.$self().creating(t),r=t.$self().saving(t);return s===!1||r===!1?null:(t.$isDirty()&&(t=this.hydrate(t.$getAttributes(),{operation:e?"set":"get"})),e&&(this.hydratedDataCache.set(this.model.$entity()+t.$getKey(void 0,!0),this.hydrate(t.$getAttributes(),{operation:"get"})),t.$self().created(t),t.$self().saved(t),this.commit("insert",this.compile(t))),t)}save(e){let t=this.newInterpreter().process(e);const s=this.model.$types(),r=this.model.$baseEntity()!==this.model.$entity();if(Object.values(s).length>0||r){const a=Object.keys(s),h={};e=w(e)?e:[e],e.forEach(c=>{const u=a.includes(`${c[this.model.$typeKey()]}`)||r?c[this.model.$typeKey()]??this.model.$fields()[this.model.$typeKey()].value:a[0];h[u]||(h[u]=[]),h[u].push(c)});for(const c in h){const u=s[c];u.entity===this.model.$entity()?t=this.newInterpreter().process(h[c]):this.newQueryWithConstraints(u.entity).save(h[c])}}const[n,o]=t;for(const a in o){const h=this.newQuery(a),c=o[a];h.saveElements(c)}return this.revive(n)}saveElements(e){const t={},s=this.commit("all"),r=[];for(const n in e){const o=e[n],a=s[n];let h=a?this.hydrate({...a,...o},{operation:"set",action:"update"}):this.hydrate(o,{operation:"set",action:"save"});const c=h.$self().saving(h,o),u=a?h.$self().updating(h,o):h.$self().creating(h,o);c===!1||u===!1||(h.$isDirty()&&(h=this.hydrate(h.$getAttributes(),{operation:"set",action:a?"update":"save"})),r.push(()=>h.$self().saved(h,o)),r.push(()=>a?h.$self().updated(h,o):h.$self().created(h,o)),t[n]=h.$getAttributes(),Object.values(h.$types()).length>0&&!t[n][h.$typeKey()]&&(t[n][h.$typeKey()]=o[h.$typeKey()]))}Object.keys(t).length>0&&(this.commit("save",t),r.forEach(n=>n()))}insert(e){const t=this.hydrate(e,{operation:"set",action:"insert"});return this.commit("insert",this.compile(t)),t}fresh(e){this.hydratedDataCache.clear();const t=this.hydrate(e,{action:"update"});return this.commit("fresh",this.compile(t)),t}update(e){const t=this.get(!1);if(X(t))return[];const s=t.map(r=>{const n=this.hydrate({...r.$getAttributes(),...e},{action:"update",operation:"set"});return r.$self().updating(r,e)===!1?r:(n.$self().updated(n),n)});return this.commit("update",this.compile(s)),s}destroy(e){return w(e)?this.destroyMany(e):this.destroyOne(e)}destroyOne(e){const t=this.find(e);if(!t)return null;const[s,r]=this.dispatchDeleteHooks(t);return r.includes(t.$getIndexId())||(this.commit("destroy",[t.$getIndexId()]),s.forEach(n=>n())),t}destroyMany(e){const t=this.find(e);if(X(t))return[];const[s,r]=this.dispatchDeleteHooks(t),n=this.getIndexIdsFromCollection(t).filter(o=>!r.includes(o));return this.commit("destroy",n),s.forEach(o=>o()),t}delete(){const e=this.get(!1);if(X(e))return[];const[t,s]=this.dispatchDeleteHooks(e),r=this.getIndexIdsFromCollection(e).filter(n=>!s.includes(n));return this.commit("delete",r),t.forEach(n=>n()),e}flush(){return this.commit("flush"),this.hydratedDataCache.clear(),this.get(!1)}checkAndDeleteRelations(e){const t=e.$fields();for(const s in t){const r=t[s];if(t[s]instanceof R&&r.onDeleteMode&&e[s]){const o=(w(e[s])?e[s]:[e[s]]).map(h=>h.$getKey(void 0,!0)),a={};if(r instanceof lt){this.newQuery(r.pivot.$entity()).where(r.foreignPivotKey,e[e.$getLocalKey()]).delete();continue}switch(r.onDeleteMode){case"cascade":{this.newQueryForRelation(r).destroy(o);break}case"set null":{r.foreignKey&&(a[r.foreignKey]=null),r.morphId&&(a[r.morphId]=null,a[r.morphType]=null),this.newQueryForRelation(r).whereId(o).update(a);break}}}}}dispatchDeleteHooks(e){const t=[],s=[];return e=w(e)?e:[e],this.withAll().load(e),e.forEach(r=>{r.$self().deleting(r)===!1?s.push(r.$getIndexId()):(this.hydratedDataCache.delete(this.model.$entity()+r.$getIndexId()),t.push(()=>r.$self().deleted(r)),this.checkAndDeleteRelations(r))}),[t,s]}getIndexIdsFromCollection(e){return e.map(t=>t.$getIndexId())}hydrate(e,t){return w(e)?e.map(s=>this.hydrate(s,t)):this.getHydratedModel(e,{relations:!1,...t||{}})}compile(e){return(w(e)?e:[e]).reduce((s,r)=>(s[r.$getIndexId()]=r.$getAttributes(),s),{})}getHydratedModel(e,t){const s=this.model.$getKey(e,!0),r=s&&this.hydratedDataCache.get(this.model.$entity()+s);if(!this.getNewHydrated&&(t==null?void 0:t.operation)!=="set"&&r)return r;const n=this.model.$types()[e[this.model.$typeKey()]],o=h=>(n?n.newRawInstance():this.model).$newInstance(e,{relations:!1,...t||{},...h}),a=o();return s&&!this.getNewHydrated&&(t==null?void 0:t.operation)!=="set"&&this.hydratedDataCache.set(this.model.$entity()+s,a),s&&(t==null?void 0:t.action)==="update"&&this.hydratedDataCache.set(this.model.$entity()+s,o({operation:"get"})),a}}var qs=Object.defineProperty,Ls=(i,e,t)=>e in i?qs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ws=(i,e,t)=>(Ls(i,typeof e!="symbol"?e+"":e,t),t),Bs=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)},T=(i,e,t)=>(Bs(i,e,"read from private field"),t?t.call(i):e.get(i)),Us=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},We,D;class ut{constructor(){Ws(this,We),Us(this,D,new Map)}has(e){var t;return!!(T(this,D).has(e)&&((t=T(this,D).get(e))!=null&&t.deref()))}get(e){const t=T(this,D).get(e);if(!t)return;const s=t.deref();if(s)return s;T(this,D).delete(e)}set(e,t){return T(this,D).set(e,new WeakRef(t)),this}get size(){return T(this,D).size}clear(){T(this,D).clear()}delete(e){return T(this,D).delete(e),!1}forEach(e){for(const[t,s]of this)e(s,t,this)}*[(We=Symbol.toStringTag,Symbol.iterator)](){for(const[e,t]of T(this,D)){const s=t.deref();if(!s){T(this,D).delete(e);continue}yield[e,s]}}*entries(){for(const[e,t]of this)yield[e,t]}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}}D=new WeakMap;const Qs=new ut,Js=new Map,Ae={model:{namespace:"",withMeta:!1,hidden:["_meta"],visible:["*"]},cache:{shared:!0,provider:ut}},M={...Ae};var Vs=Object.defineProperty,ks=(i,e,t)=>e in i?Vs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,H=(i,e,t)=>(ks(i,typeof e!="symbol"?e+"":e,t),t);class fe{constructor(e,t){H(this,"database"),H(this,"model"),H(this,"pinia"),H(this,"queryCache"),H(this,"hydratedDataCache"),H(this,"use"),H(this,"config"),this.config=M,this.database=e,this.pinia=t,this.hydratedDataCache=Js}static setModel(e){return this.useModel=e,this}setConfig(e){this.config=e}initialize(e){return this.config.cache&&this.config.cache!==!0&&(this.queryCache=this.config.cache.shared?Qs:new this.config.cache.provider),e?(this.model=e.newRawInstance(),this):this.use||this.$self().useModel?(this.use=this.use??this.$self().useModel,this.model=this.use.newRawInstance(),this):this}$self(){return this.constructor}getModel(){return oe(!!this.model,["The model is not registered. Please define the model to be used at","`use` property of the repository class."]),this.model}piniaStore(){return ct(this.model.$storeName(),this.model.$piniaOptions(),this.query())(this.pinia)}repo(e){return Ne(e)}query(){return new ae(this.database,this.getModel(),this.queryCache,this.hydratedDataCache,this.pinia)}cache(){return this.queryCache}where(e,t){return this.query().where(e,t)}orWhere(e,t){return this.query().orWhere(e,t)}whereHas(e,t=()=>{},s,r){return this.query().whereHas(e,t,s,r)}orWhereHas(e,t=()=>{},s,r){return this.query().orWhereHas(e,t,s,r)}has(e,t,s){return this.query().has(e,t,s)}orHas(e,t,s){return this.query().orHas(e,t,s)}doesntHave(e){return this.query().doesntHave(e)}orDoesntHave(e){return this.query().orDoesntHave(e)}whereDoesntHave(e,t=()=>{}){return this.query().whereDoesntHave(e,t)}orWhereDoesntHave(e,t=()=>{}){return this.query().orWhereDoesntHave(e,t)}withMeta(){return this.query().withMeta()}makeVisible(e){return this.query().makeVisible(e)}makeHidden(e){return this.query().makeHidden(e)}groupBy(...e){return this.query().groupBy(...e)}orderBy(e,t){return this.query().orderBy(e,t)}limit(e){return this.query().limit(e)}offset(e){return this.query().offset(e)}with(e,t){return this.query().with(e,t)}withAll(e){return this.query().withAll(e)}withAllRecursive(e){return this.query().withAllRecursive(e)}useCache(e,t){return this.query().useCache(e,t)}all(){return this.query().get()}find(e){return this.query().find(e)}revive(e){return this.query().revive(e)}make(e){return w(e)?e.map(t=>this.getModel().$newInstance(t,{relations:!0})):this.getModel().$newInstance(e,{relations:!0})}save(e){return this.query().save(e)}new(e=!0){return this.query().new(e)}insert(e){return this.query().insert(e)}fresh(e){return this.query().fresh(e)}destroy(e){return this.query().destroy(e)}flush(){return this.query().flush()}}H(fe,"_isRepository",!0);H(fe,"useModel");var Gs=Object.defineProperty,Ys=(i,e,t)=>e in i?Gs(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Xs=(i,e,t)=>(Ys(i,e+"",t),t);class Zs{constructor(){Xs(this,"models",{})}register(e){const t=e.$entity();this.models[t]||(this.models[t]=e,this.registerRelatedModels(e))}registerRelatedModels(e){const t=e.$fields();for(const s in t){const r=t[s];r instanceof R&&r.getRelateds().forEach(n=>{this.register(n)})}}getModel(e){return this.models[e]}}const ei=i=>i,dt=[];function ti(i){let e=M;return dt.forEach(t=>{const s=t({config:e,repository:i,model:i.getModel()});e={...e,...s.config}}),i.setConfig(e),i}function Ne(i,e){const t=new Zs,s=i._isRepository?new i(t,e).initialize():new fe(t,e).initialize(i);try{const r=Object.values(s.getModel().$types());r.length>0?r.forEach(n=>s.database.register(n.newRawInstance())):s.database.register(s.getModel())}catch{}return ti(s)}function si(i){M.model={...Ae.model,...i==null?void 0:i.model},M.cache={...Ae.cache,...i==null?void 0:i.cache};const e={use(t){return dt.push(t),this}};return()=>e}let ii=class extends he{make(e){return e===void 0?this.value:e}},ri=class extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("string",e)}};class ni extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("number",e)}}class oi extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("boolean",e)}}var ai=Object.defineProperty,hi=(i,e,t)=>e in i?ai(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Be=(i,e,t)=>(hi(i,typeof e!="symbol"?e+"":e,t),t);class Ue extends R{constructor(e,t,s,r){super(e,t),Be(this,"foreignKey"),Be(this,"localKey"),this.foreignKey=s,this.localKey=r}getRelateds(){return[this.related]}define(e){return e.one(this.related,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,r)=>{t[s]=e[r]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,r)=>e.whereIn(s,this.getKeys(t,r)))}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.localKey)];r[o]?n.$setRelation(e,r[o][0]):n.$setRelation(e,null)})}buildDictionary(e){return this.mapToDictionary(e,t=>[t[this.getKey(this.foreignKey)],t])}make(e){return e?this.related.$newInstance(e):null}}var ci=Object.defineProperty,li=(i,e,t)=>e in i?ci(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,_e=(i,e,t)=>(li(i,typeof e!="symbol"?e+"":e,t),t);let ui=class extends R{constructor(e,t,s,r){super(e,t),_e(this,"child"),_e(this,"foreignKey"),_e(this,"ownerKey"),this.foreignKey=s,this.ownerKey=r,this.child=t}getRelateds(){return[this.child]}define(e){return e.one(this.child,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.ownerKey,(s,r)=>{e[s]=t[r]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.ownerKey,(s,r)=>e.whereIn(r,this.getEagerModelKeys(t,s)))}getEagerModelKeys(e,t){return e.reduce((s,r)=>(r[t]!==null&&s.push(r[t]),s),[])}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.foreignKey)];r[o]?n.$setRelation(e,r[o]):n.$setRelation(e,null)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.getKey(this.ownerKey)]]=s,t),{})}make(e){return e?this.child.$newInstance(e):null}};var di=Object.defineProperty,fi=(i,e,t)=>e in i?di(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Qe=(i,e,t)=>(fi(i,typeof e!="symbol"?e+"":e,t),t);let pi=class extends R{constructor(e,t,s,r){super(e,t),Qe(this,"foreignKey"),Qe(this,"localKey"),this.foreignKey=s,this.localKey=r}getRelateds(){return[this.related]}define(e){return e.many(this.related,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,r)=>{t[s]=e[r]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,r)=>e.whereIn(s,this.getKeys(t,r)))}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.localKey)];r[o]?n.$setRelation(e,r[o]):n.$setRelation(e,[])})}buildDictionary(e){return this.mapToDictionary(e,t=>{const s=this.getKey(this.foreignKey);return[t[s],t]})}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}};var yi=Object.defineProperty,mi=(i,e,t)=>e in i?yi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ie=(i,e,t)=>(mi(i,typeof e!="symbol"?e+"":e,t),t);let gi=class extends R{constructor(e,t,s,r){super(e,t),Ie(this,"child"),Ie(this,"foreignKey"),Ie(this,"ownerKey"),this.foreignKey=s,this.ownerKey=r,this.child=t}getRelateds(){return[this.child]}define(e){return e.many(this.child,this.parent)}attach(e,t){t[this.ownerKey]!==void 0&&(e[this.foreignKey]||(e[this.foreignKey]=[]),this.attachIfMissing(e[this.foreignKey],t[this.ownerKey]))}attachIfMissing(e,t){e.includes(t)||e.push(t)}addEagerConstraints(e,t){e.whereIn(this.ownerKey,this.getEagerModelKeys(t))}getEagerModelKeys(e){return e.reduce((t,s)=>[...t,...s[this.foreignKey]],[])}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=this.getRelatedModels(r,n[this.foreignKey]);n.$setRelation(e,o)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.ownerKey]]=s,t),{})}getRelatedModels(e,t){return t.reduce((s,r)=>{const n=e[r];return n&&s.push(n),s},[])}make(e){return e?e.map(t=>this.child.$newInstance(t)):[]}};var $i=Object.defineProperty,wi=(i,e,t)=>e in i?$i(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Re=(i,e,t)=>(wi(i,typeof e!="symbol"?e+"":e,t),t);class Je extends R{constructor(e,t,s,r,n){super(e,t),Re(this,"morphId"),Re(this,"morphType"),Re(this,"localKey"),this.morphId=s,this.morphType=r,this.localKey=n}getRelateds(){return[this.related]}define(e){return e.one(this.related,this.parent)}attach(e,t){t[this.morphId]=e[this.localKey],t[this.morphType]=this.parent.$entity()}addEagerConstraints(e,t){e.where(this.morphType,this.parent.$entity()).whereIn(this.morphId,this.getKeys(t,this.localKey))}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.localKey];r[o]?n.$setRelation(e,r[o]):n.$setRelation(e,null)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.morphId]]=s,t),{})}make(e){return e?this.related.$newInstance(e):null}}var bi=Object.defineProperty,vi=(i,e,t)=>e in i?bi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ke=(i,e,t)=>(vi(i,typeof e!="symbol"?e+"":e,t),t);class _i extends R{constructor(e,t,s,r,n){super(e,t),Ke(this,"morphId"),Ke(this,"morphType"),Ke(this,"localKey"),this.morphId=s,this.morphType=r,this.localKey=n}getRelateds(){return[this.related]}define(e){return e.many(this.related,this.parent)}attach(e,t){t[this.morphId]=e[this.localKey],t[this.morphType]=this.parent.$entity()}addEagerConstraints(e,t){e.where(this.morphType,this.parent.$entity()),e.whereIn(this.morphId,this.getKeys(t,this.localKey))}match(e,t,s){const r=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.localKey];r[o]?n.$setRelation(e,r[o]):n.$setRelation(e,[])})}buildDictionary(e){return this.mapToDictionary(e,t=>[t[this.morphId],t])}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}}var Ii=Object.defineProperty,Ri=(i,e,t)=>e in i?Ii(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,ee=(i,e,t)=>(Ri(i,typeof e!="symbol"?e+"":e,t),t);class Ki extends R{constructor(e,t,s,r,n,o,a){super(e,t),ee(this,"through"),ee(this,"firstKey"),ee(this,"secondKey"),ee(this,"localKey"),ee(this,"secondLocalKey"),this.through=s,this.firstKey=r,this.secondKey=n,this.localKey=o,this.secondLocalKey=a}getRelateds(){return[this.related,this.through]}define(e){return e.many(this.related,this.parent)}attach(e,t){}addEagerConstraints(e,t){}match(e,t,s){const r=s.newQuery(this.through.$entity()).where(this.firstKey,this.getKeys(t,this.localKey)).get(!1),n=s.where(this.secondKey,this.getKeys(r,this.secondLocalKey)).groupBy(this.secondKey).get(!1),o=this.buildDictionary(r,n);t.forEach(a=>{const h=a[this.localKey];o[h]?a.$setRelation(e,o[h][0]):a.$setRelation(e,[])})}buildDictionary(e,t){return this.mapToDictionary(e,s=>[s[this.firstKey],t[s[this.secondLocalKey]]])}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}}var Pi=Object.defineProperty,Ci=(i,e,t)=>e in i?Pi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,W=(i,e,t)=>(Ci(i,typeof e!="symbol"?e+"":e,t),t);class Mi extends R{constructor(e,t,s,r,n,o,a,h){super(e,t),W(this,"pivot"),W(this,"morphId"),W(this,"morphType"),W(this,"relatedId"),W(this,"parentKey"),W(this,"relatedKey"),W(this,"pivotKey","pivot"),this.pivot=s,this.morphId=n,this.morphType=o,this.relatedId=r,this.parentKey=a,this.relatedKey=h}getRelateds(){return[this.related,this.pivot]}define(e){return e.many(this.related,this.parent)}attach(e,t){const s=t.pivot??{};s[this.morphId]=e[this.parentKey],s[this.morphType]=this.parent.$entity(),s[this.relatedId]=t[this.relatedKey],t[`pivot_${this.pivot.$entity()}`]=s}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}match(e,t,s){const r=s.get(!1),n=s.newQuery(this.pivot.$entity()).whereIn(this.relatedId,this.getKeys(r,this.relatedKey)).whereIn(this.morphId,this.getKeys(t,this.parentKey)).groupBy(this.morphId,this.relatedId,this.morphType).get();t.forEach(o=>{const a=[];r.forEach(h=>{var d;const c=((d=n[`[${o[this.parentKey]},${h[this.relatedKey]},${this.parent.$entity()}]`])==null?void 0:d[0])??null,u=h.$newInstance(h.$toJson());u.$setRelation("pivot",c),c&&a.push(u)}),o.$setRelation(e,a)})}addEagerConstraints(e,t){}}var xi=Object.defineProperty,Si=(i,e,t)=>e in i?xi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,b=(i,e,t)=>(Si(i,typeof e!="symbol"?e+"":e,t),t);class p{constructor(e,t={operation:"set"}){this.$boot(),(t.fill??!0)&&this.$fill(e,t)}static fields(){return{}}static initializeSchema(){this.schemas[this.entity]={},this.fieldsOnDelete[this.entity]=this.fieldsOnDelete[this.entity]??{};const e={...this.fields(),...this.registries[this.entity]};for(const t in e){const s=e[t];this.schemas[this.entity][t]=typeof s=="function"?s():s,this.fieldsOnDelete[this.entity][t]&&(this.schemas[this.entity][t]=this.schemas[this.entity][t].onDelete(this.fieldsOnDelete[this.entity][t]))}}static setRegistry(e,t){return this.registries[this.entity]||(this.registries[this.entity]={}),this.registries[this.entity][e]=t,this}static setFieldDeleteMode(e,t){return this.fieldsOnDelete[this.entity]=this.fieldsOnDelete[this.entity]??{},this.fieldsOnDelete[this.entity][e]=t,this}static setMutator(e,t){return this.fieldMutators[e]=t,this}static setCast(e,t){return this.fieldCasts[e]=t,this}static setHidden(e){return this.hidden.push(e),this}static clearBootedModels(){this.booted={},this.original={},this.schemas={},this.fieldMutators={},this.fieldCasts={},this.hidden=[],this.visible=[]}static clearRegistries(){this.registries={}}static newRawInstance(){return new this(void 0,{fill:!1})}static attr(e){return new ii(this.newRawInstance(),e)}static string(e){return new ri(this.newRawInstance(),e)}static number(e){return new ni(this.newRawInstance(),e)}static boolean(e){return new oi(this.newRawInstance(),e)}static uid(e){return new ht(this.newRawInstance(),e)}static hasOne(e,t,s){const r=this.newRawInstance();return s=s??r.$getKeyName(),new Ue(r,e.newRawInstance(),t,s)}static belongsTo(e,t,s){const r=e.newRawInstance();return s=s??r.$getKeyName(),new ui(this.newRawInstance(),r,t,s)}static belongsToMany(e,t,s,r,n,o){const a=e.newRawInstance(),h=this.newRawInstance(),c=t.newRawInstance();return n=n??h.$getLocalKey(),o=o??a.$getLocalKey(),this.schemas[e.entity][`pivot_${c.$entity()}`]=new Ue(a,c,r,o),new lt(h,a,c,s,r,n,o)}static morphToMany(e,t,s,r,n,o,a){const h=e.newRawInstance(),c=this.newRawInstance(),u=t.newRawInstance();return o=o??c.$getLocalKey(),a=a??h.$getLocalKey(),this.schemas[e.entity][`pivot_${u.$entity()}`]=new Je(h,u,s,c.$entity(),a),new Mi(c,h,u,s,r,n,o,a)}static hasMany(e,t,s){const r=this.newRawInstance();return s=s??r.$getKeyName(),new pi(r,e.newRawInstance(),t,s)}static hasManyBy(e,t,s){const r=e.newRawInstance();return s=s??r.$getLocalKey(),new gi(this.newRawInstance(),r,t,s)}static hasManyThrough(e,t,s,r,n,o){const a=this.newRawInstance(),h=t.newRawInstance();return n=n??a.$getLocalKey(),o=o??h.$getLocalKey(),new Ki(a,e.newRawInstance(),h,s,r,n,o)}static morphOne(e,t,s,r){const n=this.newRawInstance();return r=r??n.$getLocalKey(),new Je(n,e.newRawInstance(),t,s,r)}static morphTo(e,t,s,r=""){const n=this.newRawInstance(),o=e.map(a=>a.newRawInstance());return new Ee(n,o,t,s,r)}static morphMany(e,t,s,r){const n=this.newRawInstance();return r=r??n.$getLocalKey(),new _i(n,e.newRawInstance(),t,s,r)}static mutators(){return{}}static casts(){return{}}static types(){return{}}$self(){return this.constructor}$entity(){return this.$self().entity}$config(){return this.$self().config}$namespace(){return this.$self().namespace??M.model.namespace}$storeName(){return(this.$namespace()?this.$namespace()+"/":"")+this.$baseEntity()}$baseEntity(){return this.$self().baseEntity??this.$entity()}$typeKey(){return this.$self().typeKey}$types(){return this.$self().types()}$piniaOptions(){return this.$self().piniaOptions}$primaryKey(){return this.$self().primaryKey}$fields(){return this.$self().schemas[this.$entity()]}$hidden(){return this.$self().hidden}$visible(){return this.$self().visible}$newInstance(e,t){const s=this.$self();return new s(e,t)}$boot(){this.$self().booted[this.$entity()]||(this.$self().booted[this.$entity()]=!0,this.$initializeSchema())}$initializeSchema(){this.$self().initializeSchema()}$casts(){return{...this.$getCasts(),...this.$self().fieldCasts}}$fill(e={},t={}){var h;const s=t.operation??"get",r={...M.model,...this.$config()};r.withMeta&&(this.$self().schemas[this.$entity()][this.$self().metaKey]=this.$self().attr({}));const n=this.$fields(),o=t.relations??!0,a={...this.$getMutators(),...this.$self().fieldMutators};for(const c in n){if(s==="get"&&!this.isFieldVisible(c,this.$hidden(),this.$visible(),t))continue;const u=n[c];let d=e[c];if(u instanceof R&&!o)continue;const I=a==null?void 0:a[c],m=(h=this.$casts()[c])==null?void 0:h.newRawInstance(n);I&&s==="get"&&(d=typeof I=="function"?I(d):typeof I.get=="function"?I.get(d):d),m&&s==="get"&&(d=m.get(d));let l=this.$fillField(c,u,d);I&&typeof I!="function"&&s==="set"&&I.set&&(l=I.set(l)),m&&s==="set"&&(l=m.set(l)),this[c]=this[c]??l}return s==="set"&&(this.$self().original[this.$getKey(this,!0)]=this.$getAttributes()),r.withMeta&&s==="set"&&this.$fillMeta(t.action),this}$fillMeta(e="save"){const t=Math.floor(Date.now()/1e3);e==="save"&&(this[this.$self().metaKey]={createdAt:t,updatedAt:t}),e==="update"&&(this[this.$self().metaKey].updatedAt=t)}$fillField(e,t,s){if(s!==void 0)return t instanceof Ee?t.setKey(e).make(s,this[t.getType()]):t.setKey(e).make(s);if(this[e]===void 0)return t.setKey(e).make()}isFieldVisible(e,t,s,r){const n=t.length>0?t:M.model.hidden,o=[...s.length>0?s:M.model.visible,String(this.$primaryKey())],a=r.visible??[],h=r.hidden??[];return(n.includes("*")||n.includes(e))&&!a.includes(e)||h.includes(e)?!1:(o.includes("*")||o.includes(e))&&!h.includes(e)||a.includes(e)}$getKeyName(){return this.$primaryKey()}$getKey(e,t=!1){if(e=e??this,this.$hasCompositeKey()){const r=this.$getCompositeKey(e);return t?"["+(r==null?void 0:r.join(","))+"]":r}const s=e[this.$getKeyName()];return Se(s)?null:s}$hasCompositeKey(){return w(this.$getKeyName())}$getCompositeKey(e){let t=[];return this.$getKeyName().every(s=>{const r=e[s];return Se(r)?(t=null,!1):(t.push(r),!0)}),t===null?null:t}$getIndexId(e){const t=e??this,s=this.$getKey(t);return oe(s!==null,["The record is missing the primary key. If you want to persist record","without the primary key, please define the primary key field with the","`uid` attribute."]),this.$stringifyId(s)}$stringifyId(e){return w(e)?JSON.stringify(e):String(e)}$getLocalKey(){return oe(!this.$hasCompositeKey(),["Please provide the local key for the relationship. The model with the","composite key can't infer its local key."]),this.$getKeyName()}$getRelation(e){let t=this.$fields()[e];return Object.values(this.$types()).forEach(r=>{t===void 0&&(t=r.fields()[e])}),oe(t instanceof R,[`Relationship [${e}] on model [${this.$entity()}] not found.`]),t}$setRelation(e,t){return e.includes("pivot")?(this.pivot=t,this):(this.$fields()[e]&&(this[e]=t),this)}$getMutators(){return this.$self().mutators()}$getCasts(){return this.$self().casts()}$getOriginal(){return this.$self().original[this.$getKey(this,!0)]}$refresh(){return this.$isDirty()&&Object.entries(this.$getOriginal()).forEach(e=>{this[e[0]]=e[1]}),this}$isDirty(e){const t=this.$getOriginal();return e?(Object.keys(t).includes(e)||de(['The property"',e,'"does not exit in the model "',this.$entity(),'"']),!Oe(this[e],t[e])):!Oe(t,this.$getAttributes())}$getAttributes(){return this.$toJson(this,{relations:!1})}$toJson(e,t={}){e=e??this;const s=e.$fields(),r=t.relations??!0,n={};for(const o in s){const a=s[o],h=e[o];if(!(a instanceof R)){n[o]=this.serializeValue(h);continue}r&&(n[o]=this.serializeRelation(h))}return n}serializeValue(e){return e===null?null:w(e)?this.serializeArray(e):typeof e=="object"?e instanceof Date&&!isNaN(e.getTime())&&typeof e.toISOString=="function"?e.toISOString():this.serializeObject(e):e}serializeArray(e){return e.map(t=>this.serializeValue(t))}serializeObject(e){const t={};for(const s in e)t[s]=this.serializeValue(e[s]);return t}serializeRelation(e){if(e!==void 0)return e===null?null:w(e)?e.map(t=>t.$toJson()):e.$toJson()}}b(p,"entity");b(p,"baseEntity");b(p,"namespace");b(p,"primaryKey","id");b(p,"metaKey","_meta");b(p,"hidden",["_meta"]);b(p,"visible",[]);b(p,"config");b(p,"typeKey","type");b(p,"fieldsOnDelete",{});b(p,"original",{});b(p,"schemas",{});b(p,"registries",{});b(p,"piniaOptions",{});b(p,"fieldMutators",{});b(p,"fieldCasts",{});b(p,"booted",{});b(p,"saving",()=>{});b(p,"updating",()=>{});b(p,"creating",()=>{});b(p,"deleting",()=>{});b(p,"retrieved",()=>{});b(p,"saved",()=>{});b(p,"updated",()=>{});b(p,"created",()=>{});b(p,"deleted",()=>{});var Oi=Object.defineProperty,Di=(i,e,t)=>e in i?Oi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,te=(i,e,t)=>(Di(i,typeof e!="symbol"?e+"":e,t),t);class Ei{constructor(e,t,s){te(this,"repository"),te(this,"config"),te(this,"response"),te(this,"entities",null),te(this,"isSaved",!1),this.repository=e,this.config=t,this.response=s}async save(){const e=this.getDataFromResponse();if(!this.validateData(e)){console.warn("[Pinia ORM Axios] The response data could not be saved to the store because it is not an object or an array. You might want to use `dataTransformer` option to handle non-array/object response before saving it to the store.");return}let t=this.config.persistBy||"save";this.validatePersistAction(t)||(console.warn('[Pinia ORM Axios] The "persistBy" option configured is not a recognized value. Response data will be persisted by the default `save` method.'),t="save");const s=await this.repository[t](e);this.entities=Array.isArray(s)?s:[s],this.isSaved=!0}async delete(){if(this.config.delete===void 0)throw new Error("[Pinia ORM Axios] Could not delete records because the `delete` option is not set.");await this.repository.query().destroy(this.config.delete)}getDataFromResponse(){return this.config.dataTransformer?this.config.dataTransformer(this.response):this.config.dataKey?this.response.data[this.config.dataKey]:this.response.data}validateData(e){return e!==null&&typeof e=="object"}validatePersistAction(e){return["save","insert"].includes(e)}}var Ai=Object.defineProperty,Ni=(i,e,t)=>e in i?Ai(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Ve=(i,e,t)=>(Ni(i,typeof e!="symbol"?e+"":e,t),t);class Ti{constructor(e){Ve(this,"repository"),Ve(this,"config",{save:!0}),this.repository=e,this.registerActions()}get axios(){if(!this.repository.axios)throw new Error("[Pinia ORM Axios] The axios instance is not registered. Please register the axios instance to the repository.");return this.repository.axios}registerActions(){var t,s,r;const e={...(t=this.repository.config.axiosApi)==null?void 0:t.actions,...(r=(s=this.repository.getModel().$config())==null?void 0:s.axiosApi)==null?void 0:r.actions};if(e)for(const n in e){const o=e[n];typeof o=="function"?this.registerFunctionAction(n,o):this.registerObjectAction(n,o)}}registerObjectAction(e,t){this[e]=s=>this.request({...t,...s})}registerFunctionAction(e,t){this[e]=t.bind(this)}get(e,t={}){return this.request({method:"get",url:e,...t})}post(e,t={},s={}){return this.request({method:"post",url:e,data:t,...s})}put(e,t={},s={}){return this.request({method:"put",url:e,data:t,...s})}patch(e,t={},s={}){return this.request({method:"patch",url:e,data:t,...s})}delete(e,t={}){return this.request({method:"delete",url:e,...t})}async request(e){const t=this.createConfig(e),s=await this.axios.request(t);return this.createResponse(s,t)}createConfig(e){return{...this.config,...this.repository.globalApiConfig,...this.repository.apiConfig,...e}}async createResponse(e,t){const s=new Ei(this.repository,t,e);return t.delete!==void 0?(await s.delete(),s):(t.save&&await s.save(),s)}}var Fi=Object.defineProperty,Hi=(i,e,t)=>e in i?Fi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Pe=(i,e,t)=>(Hi(i,typeof e!="symbol"?e+"":e,t),t);class ft extends fe{constructor(){var e;super(...arguments),Pe(this,"axios",((e=M==null?void 0:M.axiosApi)==null?void 0:e.axios)||null),Pe(this,"globalApiConfig",(M==null?void 0:M.axiosApi)||{}),Pe(this,"apiConfig",{})}api(){return zi(this)}setAxios(e){return this.axios=e,this}}function zi(i){return new Ti(i)}function ji(i){return ei(e=>(e.config.axiosApi=i,e))}const qi=Jt(),pt=si();pt().use(ji({axios:window.axios,baseURL:window.SupportChat.path+"/api/v1",dataKey:"data"}));const Li=qi.use(pt);function F(i){return(e,t)=>{const s=e.$self();s.setRegistry(t,()=>s.attr(i))}}function K(i,e={}){return(t,s)=>{const r=t.$self();r.setRegistry(s,()=>{const n=r.string(i);return e.notNullable&&n.notNullable(),n})}}function pe(i,e={}){return(t,s)=>{const r=t.$self();r.setRegistry(s,()=>{const n=r.number(i);return e.notNullable&&n.notNullable(),n})}}function z(i,e={}){return(t,s)=>{const r=t.$self();r.setRegistry(s,()=>{const n=r.boolean(i);return e.notNullable&&n.notNullable(),n})}}function yt(i){return(e,t)=>{const s=e.$self();s.setRegistry(t,()=>s.uid(i))}}function ye(i,e,t){return(s,r)=>{const n=s.$self();n.setRegistry(r,()=>n.belongsTo(i(),e,t))}}function mt(i,e,t,s,r,n){return(o,a)=>{const h=o.$self();h.setRegistry(a,()=>h.belongsToMany(i(),e(),t,s,r,n))}}function me(i,e,t){return(s,r)=>{const n=s.$self();n.setRegistry(r,()=>n.hasMany(i(),e,t))}}function Wi(i,e,t){return(s,r)=>{const n=s.$self();n.setRegistry(r,()=>n.hasManyBy(i(),e,t))}}var Bi=Object.defineProperty,gt=(i,e,t,s)=>{for(var r=void 0,n=i.length-1,o;n>=0;n--)(o=i[n])&&(r=o(e,t,r)||r);return r&&Bi(e,t,r),r};class J extends p{}f(J,"entity","roomUser"),f(J,"primaryKey",["roomId","userId"]);gt([F()],J.prototype,"roomId");gt([F()],J.prototype,"userId");var Ui=Object.defineProperty,S=(i,e,t,s)=>{for(var r=void 0,n=i.length-1,o;n>=0;n--)(o=i[n])&&(r=o(e,t,r)||r);return r&&Ui(e,t,r),r};class C extends p{}f(C,"entity","messageFiles"),f(C,"primaryKey",["messageId","name"]);S([K("")],C.prototype,"messageId");S([K("")],C.prototype,"name");S([K("")],C.prototype,"type");S([K("")],C.prototype,"extension");S([K("")],C.prototype,"url");S([K(null)],C.prototype,"localUrl");S([K(null)],C.prototype,"preview");S([pe(null)],C.prototype,"size");S([z(null)],C.prototype,"audio");S([pe(null)],C.prototype,"duration");S([pe(null)],C.prototype,"progress");S([F()],C.prototype,"blob");S([ye(()=>ge,"messageId")],C.prototype,"message");var Qi=Object.defineProperty,v=(i,e,t,s)=>{for(var r=void 0,n=i.length-1,o;n>=0;n--)(o=i[n])&&(r=o(e,t,r)||r);return r&&Qi(e,t,r),r},ce;const y=(ce=class extends p{get id(){return this.indexId??this._id}},f(ce,"entity","messages"),f(ce,"primaryKey","_id"),ce);v([yt(7)],y.prototype,"_id");v([F()],y.prototype,"roomId");v([K(window.SupportChat.userId)],y.prototype,"senderId");v([K(null)],y.prototype,"replyMessageId");v([F(null)],y.prototype,"indexId");v([K(null)],y.prototype,"content");v([K(null)],y.prototype,"username");v([K(null)],y.prototype,"avatar");v([K(null)],y.prototype,"date");v([K(null)],y.prototype,"timestamp");v([z(null)],y.prototype,"system");v([z(null)],y.prototype,"saved");v([z(null)],y.prototype,"distributed");v([z(null)],y.prototype,"seen");v([z(null)],y.prototype,"deleted");v([z(null)],y.prototype,"failure");v([z(null)],y.prototype,"disableActions");v([z(null)],y.prototype,"disableReactions");v([F({})],y.prototype,"reactions");v([ye(()=>x,"roomId")],y.prototype,"room");v([ye(()=>E,"senderId")],y.prototype,"sender");v([me(()=>C,"messageId")],y.prototype,"files");v([ye(()=>y,"replyMessageId")],y.prototype,"replyMessage");v([me(()=>y,"replyMessageId")],y.prototype,"replies");let ge=y;var Ji=Object.defineProperty,V=(i,e,t,s)=>{for(var r=void 0,n=i.length-1,o;n>=0;n--)(o=i[n])&&(r=o(e,t,r)||r);return r&&Ji(e,t,r),r};class E extends p{}f(E,"entity","users"),f(E,"primaryKey","_id");V([F()],E.prototype,"_id");V([K("")],E.prototype,"username");V([K("")],E.prototype,"avatar");V([F()],E.prototype,"status");V([mt(()=>x,()=>J,"userId","roomId")],E.prototype,"rooms");V([me(()=>ge,"senderId")],E.prototype,"messages");var Vi=Object.defineProperty,j=(i,e,t,s)=>{for(var r=void 0,n=i.length-1,o;n>=0;n--)(o=i[n])&&(r=o(e,t,r)||r);return r&&Vi(e,t,r),r};class x extends p{}f(x,"entity","rooms"),f(x,"primaryKey","roomId");j([yt(7)],x.prototype,"roomId");j([K("")],x.prototype,"roomName");j([K("")],x.prototype,"avatar");j([pe(null)],x.prototype,"unreadCount");j([F(null)],x.prototype,"index");j([F(null)],x.prototype,"typingUsers");j([mt(()=>E,()=>J,"roomId","userId")],x.prototype,"users");j([Wi(()=>E,"typingUsers")],x.prototype,"usersTyping");j([me(()=>ge,"roomId")],x.prototype,"messages");class ki extends ft{constructor(){super(...arguments);f(this,"use",x);f(this,"loaded",!1);f(this,"fetch",async()=>{this.loaded=!1;const t=await this.api().get("/rooms");return this.loaded=!0,t});f(this,"add",async()=>{const{roomId:t}=this.new();return await this.api().post("/rooms",{id:t})});f(this,"delete",async t=>await this.api().delete(`/rooms/${t}`,{delete:1}));f(this,"setUsers",(t,s)=>{this.query().whereId(t).update({users:s})});f(this,"joinUser",(t,s)=>{var n;const r=((n=this.find(t))==null?void 0:n.users)??[];this.query().whereId(t).update({users:[...r,s]})});f(this,"leaveUser",(t,s)=>{var o;const n=(((o=this.find(t))==null?void 0:o.users)??[]).filter(a=>a._id!==s._id);this.query().whereId(t).update({users:n})});f(this,"messagePosted",(t,s)=>{})}joined(){return this.with("users",t=>{t.whereId(window.SupportChat.userId)})}}const se=window.SupportChat.path+"/api/v1",Gi={index(){return window.axios.get(se+"/rooms")},store(i){return window.axios.post(se+"/rooms",i)},show(i){return window.axios.get(se+"/rooms/"+i)},update(i,e){return window.axios.put(se+"/rooms/"+i,e)},destroy(i){return window.axios.delete(se+"/rooms/"+i)}},ie=window.SupportChat.path+"/api/v1",Yi={index(i){return window.axios.get(`${ie}/rooms/${i}/messages`)},store(i,e){return window.axios.post(`${ie}/rooms/${i}/messages`,e)},show(i){return window.axios.get(`${ie}/messages/${i}`)},update(i,e){return window.axios.put(`${ie}/messages/${i}`,e)},destroy(i){return window.axios.delete(`${ie}/messages/${i}`)}},ke=window.SupportChat.path+"/api/v1",Xi={store(i,e){return window.axios.post(`${ke}/messages/${i}/reactions`,e,{headers:{"Content-Type":"text/plain"}})},destroy(i,e){return window.axios.delete(`${ke}/messages/${i}/reactions/${e}`)}},Ce=window.SupportChat.path+"/api/v1",Zi={store(i,e,t){return window.axios.post(`${Ce}/messages/${i}/attachments`,e,t)},show(i,e){return window.axios.get(`${Ce}/messages/${i}/attachments/${e}`)},destroy(i,e){return window.axios.delete(`${Ce}/messages/${i}/attachments/${e}`)}},Ge={rooms:Gi,messages:Yi,messageReactions:Xi,attachments:Zi};class er extends ft{constructor(){super(...arguments);f(this,"use",ge);f(this,"loaded",!1);f(this,"fetch",async({room:t})=>{this.loaded=!1;const s=await this.api().get(`/rooms/${t.roomId}/messages`);return this.loaded=!0,s});f(this,"send",async({roomId:t,content:s,files:r,replyMessage:n})=>{const{_id:o}=this.init({content:s,replyMessage:n,files:r});return await this.trySend({roomId:t,message:{_id:o,content:s,replyMessage:n,files:r}})});f(this,"trySend",async({roomId:t,message:s})=>{var r,n;try{return await this.api().post(`/rooms/${t}/messages`,{id:s._id,parent_id:(r=s.replyMessage)==null?void 0:r._id,content:s.content,attachments:((n=s.files)==null?void 0:n.map(o=>({name:o.name+"."+o.extension,type:o.type,size:o.size})))??[]})}catch(o){throw this.where("_id",s._id).update({failure:!0}),o}});f(this,"edit",async({messageId:t,newContent:s,replyMessage:r})=>{});f(this,"delete",async({message:t})=>await this.api().delete(`/messages/${t._id}`,{delete:1}));f(this,"sendReaction",async({messageId:t,reaction:s,remove:r})=>{r?(this.reactionRemoved({messageId:t,userId:window.SupportChat.userId,emoji:s.unicode}),await Ge.messageReactions.destroy(t,s.unicode)):(this.reactionLeft({messageId:t,userId:window.SupportChat.userId,emoji:s.unicode}),await Ge.messageReactions.store(t,s.unicode))});f(this,"posted",(t,s)=>this.save({...s,roomId:t}));f(this,"edited",t=>this.save(t));f(this,"deleted",t=>this.save({...t,deleted:!0}));f(this,"reactionLeft",({messageId:t,userId:s,emoji:r})=>{const n=this.find(t).reactions;return n[r]=[...new Set(n[r]).add(s)],this.query().whereId(t).update({reactions:n})});f(this,"reactionRemoved",({messageId:t,userId:s,emoji:r})=>{const n=this.find(t).reactions,o=new Set(n[r]);return o.delete(s),n[r]=[...o],this.query().whereId(t).update({reactions:n})})}init({content:t,replyMessage:s,files:r}){return this.save({content:t,files:(r||[]).map(n=>({name:n.name,type:n.type,extension:n.extension,url:n.localURL,localUrl:n.localURL,preview:"",size:n.size,audio:!1,duration:0,progress:0,blob:n.blob})),replyMessage:s})}}const tr="/vendor/support-chat/build/assets/favicon-DXKRda58.svg",sr=["height","current-user-id",".rooms","rooms-loaded",".messages","messages-loaded",".room-actions",".menu-actions"],ir=Nt({__name:"SupportChat",setup(i){Bt();const e=re(),t={x:"center",y:"center",minwidth:250,minheight:400,icon:tr,title:"Support Chat",class:"modern"},s=re("600px"),r=Q(()=>Ne(ki)),n=Q(()=>Ne(er)),o=Q(()=>r.value.all()),a=Q(()=>r.value.joined().get()),h=Q(()=>n.value.all()),c=re([{name:"deleteRoom",title:"Delete Room"}]);Tt(async()=>{await r.value.fetch();for(const m of a.value)window.roomChannel=window.Echo.join(`support-chat.room.${m.roomId}`),window.roomChannel.here(l=>r.value.setUsers(m.roomId,l)).joining(l=>r.value.joinUser(m.roomId,l)).leaving(l=>r.value.leaveUser(m.roomId,l)).listenToAll((l,g)=>console.log(l,g)).error(l=>console.error(l)).listen(".message.posted",l=>n.value.posted(m.roomId,l)).listen(".message.edited",l=>n.value.edited(l)).listen(".message.deleted",l=>n.value.deleted(l)).listen(".reaction.left",l=>n.value.reactionLeft(l)).listen(".reaction.removed",l=>n.value.reactionRemoved(l))});function u(m){window.location.assign(m.file.file.url)}function d({roomId:m,action:l}){switch(l.name){case"deleteRoom":r.value.delete(m)}}function I(m){s.value=m.height-35+"px"}return(m,l)=>(He(),Ft(Ht(jt),{ref_key:"wbRef",ref:e,options:t,onResize:I},{default:zt(()=>[m.$env.userId?(He(),qt("vue-advanced-chat",{key:0,height:s.value,"current-user-id":m.$env.userId,".rooms":o.value,"rooms-loaded":r.value.loaded,"room-info-enabled":!1,".messages":h.value,"messages-loaded":n.value.loaded,".room-actions":c.value,".menu-actions":c.value,onFetchMessages:l[0]||(l[0]=g=>n.value.fetch(g.detail[0])),onFetchMoreRooms:l[1]||(l[1]=(...g)=>r.value.fetch&&r.value.fetch(...g)),onSendMessage:l[2]||(l[2]=g=>n.value.send(g.detail[0])),onEditMessage:l[3]||(l[3]=g=>n.value.edit(g.detail[0])),onDeleteMessage:l[4]||(l[4]=g=>n.value.delete(g.detail[0])),onOpenFile:l[5]||(l[5]=g=>u(g.detail[0])),onOpenFailedMessage:l[6]||(l[6]=g=>n.value.trySend(g.detail[0])),onAddRoom:l[7]||(l[7]=(...g)=>r.value.add&&r.value.add(...g)),onRoomActionHandler:l[8]||(l[8]=g=>d(g.detail[0])),onMenuActionHandler:l[9]||(l[9]=g=>d(g.detail[0])),onSendMessageReaction:l[10]||(l[10]=g=>n.value.sendReaction(g.detail[0]))},null,40,sr)):Lt("",!0)]),_:1},512))}});Wt({}).component("support-chat",ir).use(Ut).use(Li).mount("#support-chat");
