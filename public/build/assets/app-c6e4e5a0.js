var _t=Object.defineProperty;var It=(r,e,t)=>e in r?_t(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e,t)=>(It(r,typeof e!="symbol"?e+"":e,t),t);import{e as Ge,r as ie,m as Ye,i as Rt,w as Kt,a as Pt,b as ce,c as Xe,t as Ct,h as Ot,g as Mt,o as xt,n as St,d as Dt,f as Q,j as Et,k as At,l as Nt,p as Tt,u as Ft,q as Te,s as Ht,v as zt,V as jt,x as qt}from"./winbox-c232e572.js";import{r as Lt}from"./advanced-chat-99812c21.js";const Wt={install(r){r.config.globalProperties.$env=window.SupportChat,r.provide("env",window.SupportChat)}};var Bt=!1;/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let Ze;const le=r=>Ze=r,ke=Symbol();function Pe(r){return r&&typeof r=="object"&&Object.prototype.toString.call(r)==="[object Object]"&&typeof r.toJSON!="function"}var ne;(function(r){r.direct="direct",r.patchObject="patch object",r.patchFunction="patch function"})(ne||(ne={}));function Ut(){const r=Ge(!0),e=r.run(()=>ie({}));let t=[],s=[];const i=Ye({install(n){le(i),i._a=n,n.provide(ke,i),n.config.globalProperties.$pinia=i,s.forEach(o=>t.push(o)),s=[]},use(n){return!this._a&&!Bt?s.push(n):t.push(n),this},_p:t,_a:null,_e:r,_s:new Map,state:e});return i}const et=()=>{};function Fe(r,e,t,s=et){r.push(e);const i=()=>{const n=r.indexOf(e);n>-1&&(r.splice(n,1),s())};return!t&&Mt()&&xt(i),i}function B(r,...e){r.slice().forEach(t=>{t(...e)})}const Qt=r=>r();function Ce(r,e){r instanceof Map&&e instanceof Map&&e.forEach((t,s)=>r.set(s,t)),r instanceof Set&&e instanceof Set&&e.forEach(r.add,r);for(const t in e){if(!e.hasOwnProperty(t))continue;const s=e[t],i=r[t];Pe(i)&&Pe(s)&&r.hasOwnProperty(t)&&!ce(s)&&!Xe(s)?r[t]=Ce(i,s):r[t]=s}return r}const Jt=Symbol();function Vt(r){return!Pe(r)||!r.hasOwnProperty(Jt)}const{assign:q}=Object;function Gt(r){return!!(ce(r)&&r.effect)}function Yt(r,e,t,s){const{state:i,actions:n,getters:o}=e,a=t.state.value[r];let h;function c(){a||(t.state.value[r]=i?i():{});const u=Dt(t.state.value[r]);return q(u,n,Object.keys(o||{}).reduce((d,I)=>(d[I]=Ye(Q(()=>{le(t);const m=t._s.get(r);return o[I].call(m,m)})),d),{}))}return h=tt(r,c,e,t,s,!0),h}function tt(r,e,t={},s,i,n){let o;const a=q({actions:{}},t),h={deep:!0};let c,u,d=[],I=[],m;const l=s.state.value[r];!n&&!l&&(s.state.value[r]={}),ie({});let g;function Ne(_){let $;c=u=!1,typeof _=="function"?(_(s.state.value[r]),$={type:ne.patchFunction,storeId:r,events:m}):(Ce(s.state.value[r],_),$={type:ne.patchObject,payload:_,storeId:r,events:m});const N=g=Symbol();St().then(()=>{g===N&&(c=!0)}),u=!0,B(d,$,s.state.value[r])}const mt=n?function(){const{state:$}=t,N=$?$():{};this.$patch(L=>{q(L,N)})}:et;function gt(){o.stop(),d=[],I=[],s._s.delete(r)}function $t(_,$){return function(){le(s);const N=Array.from(arguments),L=[],Y=[];function bt(S){L.push(S)}function vt(S){Y.push(S)}B(I,{args:N,name:_,store:A,after:bt,onError:vt});let X;try{X=$.apply(this&&this.$id===r?this:A,N)}catch(S){throw B(Y,S),S}return X instanceof Promise?X.then(S=>(B(L,S),S)).catch(S=>(B(Y,S),Promise.reject(S))):(B(L,X),X)}}const wt={_p:s,$id:r,$onAction:Fe.bind(null,I),$patch:Ne,$reset:mt,$subscribe(_,$={}){const N=Fe(d,_,$.detached,()=>L()),L=o.run(()=>Kt(()=>s.state.value[r],Y=>{($.flush==="sync"?u:c)&&_({storeId:r,type:ne.direct,events:m},Y)},q({},h,$)));return N},$dispose:gt},A=Pt(wt);s._s.set(r,A);const G=(s._a&&s._a.runWithContext||Qt)(()=>s._e.run(()=>(o=Ge()).run(e)));for(const _ in G){const $=G[_];if(ce($)&&!Gt($)||Xe($))n||(l&&Vt($)&&(ce($)?$.value=l[_]:Ce($,l[_])),s.state.value[r][_]=$);else if(typeof $=="function"){const N=$t(_,$);G[_]=N,a.actions[_]=$}}return q(A,G),q(Ct(A),G),Object.defineProperty(A,"$state",{get:()=>s.state.value[r],set:_=>{Ne($=>{q($,_)})}}),s._p.forEach(_=>{q(A,o.run(()=>_({store:A,app:s._a,pinia:s,options:a})))}),l&&n&&t.hydrate&&t.hydrate(A.$state,l),c=!0,u=!0,A}function Xt(r,e,t){let s,i;const n=typeof e=="function";typeof r=="string"?(s=r,i=n?t:e):(i=r,s=r.id);function o(a,h){const c=Ot();return a=a||(c?Rt(ke,null):null),a&&le(a),a=Ze,a._s.has(s)||(n?tt(s,e,i,a):Yt(s,i,a)),a._s.get(s)}return o.$id=s,o}function Zt(r,e,t){switch(t){case">":return r>e;case">=":return r>=e;case"<":return r<e;case"<=":return r<=e;case"=":return r===e;case"!=":return r!==e;default:return r===e}}function Oe(r){return r==null}function w(r){return Array.isArray(r)}function me(r){return typeof r=="function"}function Z(r){return kt(r)===0}function kt(r){return w(r)?r.length:Object.keys(r).length}function es(r,e,t,s="SORT_REGULAR"){let i=-1;const n=r.map(o=>({criteria:e.map(h=>typeof h=="function"?h(o):o[h]),index:++i,value:o}));return ts(n,(o,a)=>ss(o,a,t,s))}function ts(r,e){let t=r.length;r.sort(e);const s=[];for(;t--;)s[t]=r[t].value;return s}function ss(r,e,t,s){let i=-1;const n=r.criteria,o=e.criteria,a=n.length;for(;++i<a;){const h=rs(n[i],o[i],s);if(h){const c=t[i];return h*(c==="desc"?-1:1)}}return r.index-e.index}function rs(r,e,t){if(r!==e){const s=r!==void 0,i=r===null,n=r===r,o=e!==void 0,a=e===null;return(typeof r!="number"||typeof e!="number")&&(r=String(r),e=String(e),t==="SORT_FLAG_CASE"&&(r=r.toUpperCase(),e=e.toUpperCase())),!a&&r>e||i&&o||!s||!n?1:-1}return 0}function is(r,e){return r.reduce((t,s)=>{const i=e(s);return t[i]===void 0&&(t[i]=[]),t[i].push(s),t},{})}function ue(r){throw new Error(["[Pinia ORM]"].concat(r).join(" "))}function oe(r,e){r||ue(e)}function ns(r,e){let t="",s=r;for(;s--;)t+=e[Math.random()*64|0];return t}function os(r,e){const s=JSON.stringify(e?{key:r,params:e}:{key:r});return typeof process>"u"?btoa(s):s}function Me(r,e){if(r===e)return!0;if(r instanceof Date&&e instanceof Date)return r.getTime()===e.getTime();if(!r||!e||typeof r!="object"&&typeof e!="object")return r===e;if(r.prototype!==e.prototype)return!1;const t=Object.keys(r);return t.length!==Object.keys(e).length?!1:t.every(s=>Me(r[s],e[s]))}class as{constructor(e,t={},s={}){if(!e||typeof e!="string")throw new Error(`Expected a string key for Entity, but found ${e}.`);const{idAttribute:i="id",mergeStrategy:n=(a,h)=>({...a,...h}),processStrategy:o=a=>({...a})}=s;this._key=e,this._getId=i,this._mergeStrategy=n,this._processStrategy=o,this.define(t)}get key(){return this._key}define(e){this.schema=Object.keys(e).reduce((t,s)=>{const i=e[s];return{...t,[s]:i}},this.schema||{})}getId(e,t,s){return this._getId(e,t,s)}merge(e,t){return this._mergeStrategy(e,t)}normalize(e,t,s,i,n,o){const a=this.getId(e,t,s),h=this.key;if(h in o||(o[h]={}),a in o[h]||(o[h][a]=[]),o[h][a].includes(e))return a;o[h][a].push(e);const c=this._processStrategy(e,t,s);return Object.keys(this.schema).forEach(u=>{if(c.hasOwnProperty(u)&&typeof c[u]=="object"){const d=this.schema[u],I=typeof d=="function"?d(e):d;c[u]=i(c[u],c,u,I,n,o)}}),n(this,c,e,t,s),a}}class st{constructor(e,t){t&&(this._schemaAttribute=typeof t=="string"?s=>s[t]:t),this.define(e)}get isSingleSchema(){return!this._schemaAttribute}define(e){this.schema=e}getSchemaAttribute(e,t,s){return!this.isSingleSchema&&this._schemaAttribute(e,t,s)}inferSchema(e,t,s){if(this.isSingleSchema)return this.schema;const i=this.getSchemaAttribute(e,t,s);return this.schema[i]}normalizeValue(e,t,s,i,n,o){const a=this.inferSchema(e,t,s);if(!a)return e;const h=i(e,t,s,a,n,o);return this.isSingleSchema||h===void 0||h===null?h:{id:h,schema:this.getSchemaAttribute(e,t,s)}}}class hs extends st{constructor(e,t){if(!t)throw new Error('Expected option "schemaAttribute" not found on UnionSchema.');super(e,t)}normalize(e,t,s,i,n,o){return this.normalizeValue(e,t,s,i,n,o)}}const cs=r=>{if(Array.isArray(r)&&r.length>1)throw new Error(`Expected schema definition to be a single schema, but found ${r.length}.`);return r[0]},rt=r=>Array.isArray(r)?r:Object.keys(r).map(e=>r[e]),ls=(r,e,t,s,i,n,o)=>rt(e).map(a=>i(a,t,s,cs(r),n,o));class us extends st{normalize(e,t,s,i,n,o){return rt(e).map(a=>this.normalizeValue(a,t,s,i,n,o)).filter(a=>a!=null)}}const ds=(r,e,t,s,i,n,o)=>{const a={...e};return Object.keys(r).forEach(h=>{const c=r[h],u=typeof c=="function"?c(e):c,d=i(e[h],e,h,u,n,o);d==null?delete a[h]:a[h]=d}),a},xe=(r,e,t,s,i,n)=>typeof r!="object"||!r?r:typeof s=="object"&&(!s.normalize||typeof s.normalize!="function")?(Array.isArray(s)?ls:ds)(s,r,e,t,xe,i,n):s.normalize(r,e,t,xe,i,n),fs=r=>(e,t,s,i,n)=>{const o=e.key,a=e.getId(s,i,n);o in r||(r[o]={}),r[o][a]=r[o][a]?e.merge(r[o][a],t):t},ge={Array:us,Entity:as,Union:hs},ps=(r,e)=>{if(!r||typeof r!="object")throw new Error(`Unexpected input given to normalize. Expected type to be "object", found "${r===null?"null":typeof r}".`);const t={},s=fs(t),n=xe(r,r,null,e,s,{});return{entities:t,result:n}};var ys=Object.defineProperty,ms=(r,e,t)=>e in r?ys(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ae=(r,e,t)=>(ms(r,typeof e!="symbol"?e+"":e,t),t);class it{constructor(e){Ae(this,"$parameters",{}),this.$self().attributes=e,this.$parameters={...this.$parameters,...this.$self().parameters}}get(e){return e}set(e){return e}static withParameters(e){return this.parameters=e,this}getParameters(){return this.$parameters}$self(){return this.constructor}static newRawInstance(e){return new this(e)}}Ae(it,"attributes");Ae(it,"parameters");var gs=Object.defineProperty,$s=(r,e,t)=>e in r?gs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,He=(r,e,t)=>($s(r,typeof e!="symbol"?e+"":e,t),t);class nt{constructor(e){He(this,"model"),He(this,"key"),this.model=e,this.key=""}setKey(e){return this.key=e,this}}var ws=Object.defineProperty,bs=(r,e,t)=>e in r?ws(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e,t)=>(bs(r,typeof e!="symbol"?e+"":e,t),t);class R extends nt{constructor(e,t){super(e),$e(this,"parent"),$e(this,"related"),$e(this,"onDeleteMode"),this.parent=e,this.related=t}getRelated(){return this.related}getKeys(e,t){return e.map(s=>s[t])}onDelete(e){return this.onDeleteMode=e,this}mapToDictionary(e,t){return e.reduce((s,i)=>{const[n,o]=t(i);return s[n]||(s[n]=[]),s[n].push(o),s},{})}compositeKeyMapper(e,t,s){w(e)&&w(t)?e.forEach((i,n)=>{s(i,t[n])}):!w(t)&&!w(e)?s(e,t):ue(["This relation cant be resolve. Either child or parent doesnt have different key types (composite)",JSON.stringify(e),JSON.stringify(t)])}getKey(e){return w(e)?`[${e.join(",")}]`:e}}var vs=Object.defineProperty,_s=(r,e,t)=>e in r?vs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,k=(r,e,t)=>(_s(r,typeof e!="symbol"?e+"":e,t),t);class Se extends R{constructor(e,t,s,i,n){super(e,e),k(this,"relatedModels"),k(this,"relatedTypes"),k(this,"morphId"),k(this,"morphType"),k(this,"ownerKey"),this.relatedModels=t,this.relatedTypes=this.createRelatedTypes(t),this.morphId=s,this.morphType=i,this.ownerKey=n}createRelatedTypes(e){return e.reduce((t,s)=>(t[s.$entity()]=s,t),{})}getType(){return this.morphType}getRelateds(){return this.relatedModels}define(e){return e.union(this.relatedModels,(t,s,i)=>{const n=s[this.morphType],o=this.relatedTypes[n],a=this.ownerKey||o.$getKeyName();return s[this.morphId]=t[a],n})}attach(e,t){}addEagerConstraints(e,t){}match(e,t,s){const i=this.buildDictionary(s,t);t.forEach(n=>{var c;const o=n[this.morphType],a=n[this.morphId],h=((c=i[o])==null?void 0:c[a])??null;n.$setRelation(e,h)})}make(e,t){return!e||!t?null:this.relatedTypes[t].$newInstance(e)}buildDictionary(e,t){const s=this.getKeysByEntity(t),i={};for(const n in s){const o=this.relatedTypes[n];oe(!!o,[`Trying to load "morph to" relation of \`${n}\``,"but the model could not be found."]);const a=this.ownerKey||o.$getKeyName(),h=e.newQueryWithConstraints(n).whereIn(a,s[n]).get(!1);i[n]=h.reduce((c,u)=>(c[u[a]]=u,c),{})}return i}getKeysByEntity(e){return e.reduce((t,s)=>{const i=s[this.morphType],n=s[this.morphId];return n!==null&&this.relatedTypes[i]!==void 0&&(t[i]||(t[i]=[]),t[i].push(n)),t},{})}}var Is=Object.defineProperty,Rs=(r,e,t)=>e in r?Is(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ze=(r,e,t)=>(Rs(r,typeof e!="symbol"?e+"":e,t),t);class he extends nt{constructor(e,t=null){super(e),ze(this,"value"),ze(this,"isNullable",!0),this.value=typeof t=="function"?t():t}notNullable(){return this.isNullable=!1,this}makeReturn(e,t){return t===void 0?this.value:t===null?(this.isNullable||this.throwWarning(["is set as non nullable!"]),t):(typeof t!==e&&this.throwWarning([t,"is not a",e]),t)}throwWarning(e){console.warn(["[Pinia ORM]"].concat([`Field ${this.model.$entity()}:${this.key} - `,...e]).join(" "))}}var Ks=Object.defineProperty,Ps=(r,e,t)=>e in r?Ks(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,we=(r,e,t)=>(Ps(r,typeof e!="symbol"?e+"":e,t),t);let ot=class extends he{constructor(e,t={}){super(e),we(this,"options"),we(this,"alphabet","useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"),we(this,"size",21),this.options=typeof t=="number"?{size:t}:t,this.alphabet=this.options.alphabet??this.alphabet,this.size=this.options.size??this.size}make(e){const t=this.model.$casts()[this.model.$getKeyName()];return t?e??t.withParameters(this.options).newRawInstance(this.model.$fields()).set(e):e??ns(this.size,this.alphabet)}};var Cs=Object.defineProperty,Os=(r,e,t)=>e in r?Cs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,je=(r,e,t)=>(Os(r,typeof e!="symbol"?e+"":e,t),t);class Ms{constructor(e){je(this,"schemas",{}),je(this,"model"),this.model=e}one(e,t){e=e||this.model,t=t||this.model;const s=`${e.$entity()}${t.$entity()}`;if(this.schemas[s])return this.schemas[s];const i=this.newEntity(e,t);this.schemas[s]=i;const n=this.definition(e);return i.define(n),i}many(e,t){return new ge.Array(this.one(e,t))}union(e,t){const s=e.reduce((i,n)=>(i[n.$entity()]=this.one(n),i),{});return new ge.Union(s,t)}newEntity(e,t){const s=e.$entity(),i=this.idAttribute(e,t);return new ge.Entity(s,{},{idAttribute:i})}idAttribute(e,t){const s=this.getUidPrimaryKeyPairs(e);return(i,n,o)=>{var h,c,u;o!==null&&((h=t.$fields()[o])==null||h.attach(n,i));for(const d in s)Oe(i[d])&&(i[d]=s[d].setKey(d).make(i[d]));return["BelongsTo","HasOne","MorphOne","MorphTo"].includes(((c=t.$fields()[o])==null?void 0:c.constructor.name)??"")&&w(n[o])&&ue(['You are passing a list to "',`${t.$entity()}.${o}`,`" which is a one to one Relation(${(u=t.$fields()[o])==null?void 0:u.constructor.name}):`,JSON.stringify(n[o])]),e.$getIndexId(i)}}getUidPrimaryKeyPairs(e){const t=e.$fields(),s=e.$getKeyName(),i=w(s)?s:[s],n={};return i.forEach(o=>{const a=t[o];a instanceof ot&&(n[o]=a)}),n}definition(e){const t=e.$fields(),s={};for(const i in t){const n=t[i];n instanceof R&&(s[i]=n.define(this))}return s}}var xs=Object.defineProperty,Ss=(r,e,t)=>e in r?xs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ds=(r,e,t)=>(Ss(r,typeof e!="symbol"?e+"":e,t),t);class Es{constructor(e){Ds(this,"model"),this.model=e}process(e){const t=this.normalize(e);return[e,t]}normalize(e){const t=w(e)?[this.getSchema()]:this.getSchema();return ps(e,t).entities}getSchema(){return new Ms(this.model).one()}}function As(r){return{save(e,t=!0){Object.assign(this.data,e),t&&r&&r.newQuery(this.$id).save(Object.values(e))},insert(e,t=!0){Object.assign(this.data,e),t&&r&&r.newQuery(this.$id).insert(Object.values(e))},update(e,t=!0){Object.assign(this.data,e),t&&r&&r.newQuery(this.$id).update(Object.values(e))},fresh(e,t=!0){this.data=e,t&&r&&r.newQuery(this.$id).fresh(Object.values(e))},destroy(e,t=!0){t&&r?r.newQuery(this.$id).newQuery(this.$id).destroy(e):e.forEach(s=>delete this.data[s])},delete(e,t=!0){t&&r?r.whereId(e).delete():e.forEach(s=>delete this.data[s])},flush(e,t=!0){this.data={},t&&r&&r.newQuery(this.$id).flush()}}}function at(r,e,t){return Xt(r,{state:()=>({data:{}}),actions:As(t),...e})}var Ns=Object.defineProperty,Ts=(r,e,t)=>e in r?Ns(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U=(r,e,t)=>(Ts(r,typeof e!="symbol"?e+"":e,t),t);let ht=class extends R{constructor(e,t,s,i,n,o,a){super(e,t),U(this,"pivot"),U(this,"foreignPivotKey"),U(this,"relatedPivotKey"),U(this,"parentKey"),U(this,"relatedKey"),U(this,"pivotKey","pivot"),this.pivot=s,this.foreignPivotKey=i,this.relatedPivotKey=n,this.parentKey=o,this.relatedKey=a}getRelateds(){return[this.related,this.pivot]}define(e){return e.many(this.related,this.parent)}attach(e,t){const s=t.pivot??{};s[this.foreignPivotKey]=e[this.parentKey],s[this.relatedPivotKey]=t[this.relatedKey],t[`pivot_${this.pivot.$entity()}`]=s}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}match(e,t,s){const i=s.get(!1),n=s.newQuery(this.pivot.$entity()).whereIn(this.relatedPivotKey,this.getKeys(i,this.relatedKey)).whereIn(this.foreignPivotKey,this.getKeys(t,this.parentKey)).groupBy(this.foreignPivotKey,this.relatedPivotKey).get();t.forEach(o=>{const a=[];i.forEach(h=>{var d;const c=((d=n[`[${o[this.parentKey]},${h[this.relatedKey]}]`])==null?void 0:d[0])??null,u=h.$newInstance(h.$toJson());u.$setRelation("pivot",c),c&&a.push(u)}),o.$setRelation(e,a)})}addEagerConstraints(e,t){}};var Fs=Object.defineProperty,Hs=(r,e,t)=>e in r?Fs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,P=(r,e,t)=>(Hs(r,typeof e!="symbol"?e+"":e,t),t);class ae{constructor(e,t,s,i,n){P(this,"database"),P(this,"model"),P(this,"wheres",[]),P(this,"orders",[]),P(this,"groups",[]),P(this,"take",null),P(this,"skip",0),P(this,"visible",["*"]),P(this,"hidden",[]),P(this,"cache"),P(this,"eagerLoad",{}),P(this,"pinia"),P(this,"fromCache",!1),P(this,"cacheConfig",{}),P(this,"getNewHydrated",!1),P(this,"hydratedDataCache"),this.database=e,this.model=t,this.pinia=n,this.cache=s,this.hydratedDataCache=i,this.getNewHydrated=!1}newQuery(e){return this.getNewHydrated=!0,new ae(this.database,this.database.getModel(e),this.cache,this.hydratedDataCache,this.pinia)}newQueryWithConstraints(e){const t=new ae(this.database,this.database.getModel(e),this.cache,this.hydratedDataCache,this.pinia);return t.eagerLoad={...this.eagerLoad},t.wheres=[...this.wheres],t.orders=[...this.orders],t.take=this.take,t.skip=this.skip,t.fromCache=this.fromCache,t.cacheConfig=this.cacheConfig,t}newQueryForRelation(e){return new ae(this.database,e.getRelated(),this.cache,new Map,this.pinia)}newInterpreter(){return new Es(this.model)}commit(e,t){const s=at(this.model.$storeName(),this.model.$piniaOptions(),this)(this.pinia);return e&&typeof s[e]=="function"&&s[e](t,!1),this.cache&&["get","all","insert","flush","delete","update","destroy"].includes(e)&&this.cache.clear(),s.$state.data}withMeta(){return this.makeVisible(["_meta"])}makeVisible(e){return this.visible=e,this.getNewHydrated=!0,this}makeHidden(e){return this.hidden=e,this.getNewHydrated=!0,this}where(e,t){return this.wheres.push({field:e,value:t,boolean:"and"}),this}whereIn(e,t){return t instanceof Set&&(t=Array.from(t)),this.wheres.push({field:e,value:t,boolean:"and"}),this}whereId(e){return this.where(this.model.$getKeyName(),e)}orWhere(e,t){return this.wheres.push({field:e,value:t,boolean:"or"}),this}whereHas(e,t=()=>{},s,i){return this.where(this.getFieldWhereForRelations(e,t,s,i))}orWhereHas(e,t=()=>{},s,i){return this.orWhere(this.getFieldWhereForRelations(e,t,s,i))}has(e,t,s){return this.where(this.getFieldWhereForRelations(e,()=>{},t,s))}orHas(e,t,s){return this.orWhere(this.getFieldWhereForRelations(e,()=>{},t,s))}doesntHave(e){return this.where(this.getFieldWhereForRelations(e,()=>{},"=",0))}orDoesntHave(e){return this.orWhere(this.getFieldWhereForRelations(e,()=>{},"=",0))}whereDoesntHave(e,t=()=>{}){return this.where(this.getFieldWhereForRelations(e,t,"=",0))}orWhereDoesntHave(e,t=()=>{}){return this.orWhere(this.getFieldWhereForRelations(e,t,"=",0))}groupBy(...e){return e.forEach(t=>{this.groups.push({field:t})}),this}orderBy(e,t="asc"){return this.orders.push({field:e,direction:t}),this}limit(e){return this.take=e,this}offset(e){return this.skip=e,this}with(e,t=()=>{}){return this.getNewHydrated=!0,this.eagerLoad[e]=t,this}withAll(e=()=>{}){let t=this.model.$fields();Object.values(this.model.$types()).forEach(i=>{t={...t,...i.fields()}});for(const i in t)t[i]instanceof R&&this.with(i,e);return this}withAllRecursive(e=3){return this.withAll(t=>{e>0&&t.withAllRecursive(e-1)})}useCache(e,t){return this.fromCache=!0,this.cacheConfig={key:e,params:t},this}getFieldWhereForRelations(e,t=()=>{},s,i){const n=this.newQuery(this.model.$entity()).with(e,t).get(!1).filter(o=>Zt(w(o[e])?o[e].length:o[e]===null?0:1,typeof s=="number"?s:i??1,typeof s=="number"||i===void 0?">=":s)).map(o=>o.$getIndexId());return o=>n.includes(o.$getIndexId())}storeFind(e=[]){const t=this.commit("all"),s=[],i=new Set(e);return i.size>0?i.forEach(n=>{t[n]&&s.push(this.hydrate(t[n],{visible:this.visible,hidden:this.hidden,operation:"get"}))}):Object.values(t).forEach(n=>s.push(this.hydrate(n,{visible:this.visible,hidden:this.hidden,operation:"get"}))),s}all(){return this.storeFind()}get(e=!0){if(!this.fromCache||!this.cache)return this.internalGet(e);const t=this.cacheConfig.key?this.cacheConfig.key+JSON.stringify(this.cacheConfig.params):os(this.model.$entity(),{where:this.wheres,groups:this.groups,orders:this.orders,eagerLoads:this.eagerLoad,skip:this.skip,take:this.take,hidden:this.hidden,visible:this.visible}),s=this.cache.get(t);if(s)return s;const i=this.internalGet(e);return this.cache.set(t,i),i}internalGet(e){this.model.$entity()!==this.model.$baseEntity()&&this.where(this.model.$typeKey(),this.model.$fields()[this.model.$typeKey()].make());const t=this.select();return Z(t)||this.eagerLoadRelations(t),e&&t.forEach(s=>s.$self().retrieved(s)),this.groups.length>0?this.filterGroup(t):t}first(){return this.limit(1).get()[0]??null}find(e){return this.whereId(e)[w(e)?"get":"first"]()}select(){let e=[];const t=this.wheres,s=this.wheres.findIndex(n=>n.field===this.model.$getKeyName());if(s>-1){const n=this.wheres[s].value;e=((me(n)?[]:w(n)?n:[n])||[]).map(String)||[],e.length>0&&(this.wheres=[...this.wheres.slice(0,s),...this.wheres.slice(s+1)])}let i=this.storeFind(e);return i=this.filterWhere(i),i=this.filterOrder(i),i=this.filterLimit(i),this.wheres=t,i}filterWhere(e){if(Z(this.wheres))return e;const t=this.getWhereComparator();return e.filter(s=>t(s))}getWhereComparator(){const{and:e,or:t}=is(this.wheres,s=>s.boolean);return s=>{const i=[];return e&&i.push(e.every(n=>this.whereComparator(s,n))),t&&i.push(t.some(n=>this.whereComparator(s,n))),i.includes(!0)}}whereComparator(e,t){return me(t.field)?t.field(e):w(t.value)?t.value.includes(e[t.field]):me(t.value)?t.value(e[t.field]):e[t.field]===t.value}filterOrder(e){if(this.orders.length===0)return e;const t=this.orders.map(i=>i.field),s=this.orders.map(i=>i.direction);return es(e,t,s)}filterGroup(e){const t={},s=this.groups.map(i=>i.field);return e.forEach(i=>{const n=s.length===1?i[s[0]]:`[${s.map(o=>i[o]).toString()}]`;t[n]=(t[n]||[]).concat(i)}),t}filterLimit(e){return this.take!==null?e.slice(this.skip,this.skip+this.take):e.slice(this.skip)}load(e){this.eagerLoadRelations(e)}eagerLoadRelations(e){for(const t in this.eagerLoad)this.eagerLoadRelation(e,t,this.eagerLoad[t])}eagerLoadRelation(e,t,s){const i=this.getRelation(t),n=this.newQueryForRelation(i);i.addEagerConstraints(n,e),s(n),i.match(t,e,n)}getRelation(e){return this.model.$getRelation(e)}revive(e){return w(e)?this.reviveMany(e):this.reviveOne(e)}reviveOne(e){this.getNewHydrated=!1;const t=this.model.$getIndexId(e),s=this.commit("get")[t]??null;if(!s)return null;const i=this.hydrate(s,{visible:this.visible,hidden:this.hidden,operation:"get"});return this.reviveRelations(i,e),i}reviveMany(e){return e.reduce((t,s)=>{const i=this.reviveOne(s);return i&&t.push(i),t},[])}reviveRelations(e,t){const s=this.model.$fields();for(const i in t){const n=s[i];if(!(n instanceof R))continue;const o=t[i];if(!o)return;if(n instanceof Se){const a=e[n.getType()];e[i]=this.newQuery(a).reviveOne(o);continue}e[i]=w(o)?this.newQueryForRelation(n).reviveMany(o):this.newQueryForRelation(n).reviveOne(o)}}new(e=!0){let t=this.hydrate({},{operation:e?"set":"get"});const s=t.$self().creating(t),i=t.$self().saving(t);return s===!1||i===!1?null:(t.$isDirty()&&(t=this.hydrate(t.$getAttributes(),{operation:e?"set":"get"})),e&&(this.hydratedDataCache.set(this.model.$entity()+t.$getKey(void 0,!0),this.hydrate(t.$getAttributes(),{operation:"get"})),t.$self().created(t),t.$self().saved(t),this.commit("insert",this.compile(t))),t)}save(e){let t=this.newInterpreter().process(e);const s=this.model.$types(),i=this.model.$baseEntity()!==this.model.$entity();if(Object.values(s).length>0||i){const a=Object.keys(s),h={};e=w(e)?e:[e],e.forEach(c=>{const u=a.includes(`${c[this.model.$typeKey()]}`)||i?c[this.model.$typeKey()]??this.model.$fields()[this.model.$typeKey()].value:a[0];h[u]||(h[u]=[]),h[u].push(c)});for(const c in h){const u=s[c];u.entity===this.model.$entity()?t=this.newInterpreter().process(h[c]):this.newQueryWithConstraints(u.entity).save(h[c])}}const[n,o]=t;for(const a in o){const h=this.newQuery(a),c=o[a];h.saveElements(c)}return this.revive(n)}saveElements(e){const t={},s=this.commit("all"),i=[];for(const n in e){const o=e[n],a=s[n];let h=a?this.hydrate({...a,...o},{operation:"set",action:"update"}):this.hydrate(o,{operation:"set",action:"save"});const c=h.$self().saving(h,o),u=a?h.$self().updating(h,o):h.$self().creating(h,o);c===!1||u===!1||(h.$isDirty()&&(h=this.hydrate(h.$getAttributes(),{operation:"set",action:a?"update":"save"})),i.push(()=>h.$self().saved(h,o)),i.push(()=>a?h.$self().updated(h,o):h.$self().created(h,o)),t[n]=h.$getAttributes(),Object.values(h.$types()).length>0&&!t[n][h.$typeKey()]&&(t[n][h.$typeKey()]=o[h.$typeKey()]))}Object.keys(t).length>0&&(this.commit("save",t),i.forEach(n=>n()))}insert(e){const t=this.hydrate(e,{operation:"set",action:"insert"});return this.commit("insert",this.compile(t)),t}fresh(e){this.hydratedDataCache.clear();const t=this.hydrate(e,{action:"update"});return this.commit("fresh",this.compile(t)),t}update(e){const t=this.get(!1);if(Z(t))return[];const s=t.map(i=>{const n=this.hydrate({...i.$getAttributes(),...e},{action:"update",operation:"set"});return i.$self().updating(i,e)===!1?i:(n.$self().updated(n),n)});return this.commit("update",this.compile(s)),s}destroy(e){return w(e)?this.destroyMany(e):this.destroyOne(e)}destroyOne(e){const t=this.find(e);if(!t)return null;const[s,i]=this.dispatchDeleteHooks(t);return i.includes(t.$getIndexId())||(this.commit("destroy",[t.$getIndexId()]),s.forEach(n=>n())),t}destroyMany(e){const t=this.find(e);if(Z(t))return[];const[s,i]=this.dispatchDeleteHooks(t),n=this.getIndexIdsFromCollection(t).filter(o=>!i.includes(o));return this.commit("destroy",n),s.forEach(o=>o()),t}delete(){const e=this.get(!1);if(Z(e))return[];const[t,s]=this.dispatchDeleteHooks(e),i=this.getIndexIdsFromCollection(e).filter(n=>!s.includes(n));return this.commit("delete",i),t.forEach(n=>n()),e}flush(){return this.commit("flush"),this.hydratedDataCache.clear(),this.get(!1)}checkAndDeleteRelations(e){const t=e.$fields();for(const s in t){const i=t[s];if(t[s]instanceof R&&i.onDeleteMode&&e[s]){const o=(w(e[s])?e[s]:[e[s]]).map(h=>h.$getKey(void 0,!0)),a={};if(i instanceof ht){this.newQuery(i.pivot.$entity()).where(i.foreignPivotKey,e[e.$getLocalKey()]).delete();continue}switch(i.onDeleteMode){case"cascade":{this.newQueryForRelation(i).destroy(o);break}case"set null":{i.foreignKey&&(a[i.foreignKey]=null),i.morphId&&(a[i.morphId]=null,a[i.morphType]=null),this.newQueryForRelation(i).whereId(o).update(a);break}}}}}dispatchDeleteHooks(e){const t=[],s=[];return e=w(e)?e:[e],this.withAll().load(e),e.forEach(i=>{i.$self().deleting(i)===!1?s.push(i.$getIndexId()):(this.hydratedDataCache.delete(this.model.$entity()+i.$getIndexId()),t.push(()=>i.$self().deleted(i)),this.checkAndDeleteRelations(i))}),[t,s]}getIndexIdsFromCollection(e){return e.map(t=>t.$getIndexId())}hydrate(e,t){return w(e)?e.map(s=>this.hydrate(s,t)):this.getHydratedModel(e,{relations:!1,...t||{}})}compile(e){return(w(e)?e:[e]).reduce((s,i)=>(s[i.$getIndexId()]=i.$getAttributes(),s),{})}getHydratedModel(e,t){const s=this.model.$getKey(e,!0),i=s&&this.hydratedDataCache.get(this.model.$entity()+s);if(!this.getNewHydrated&&(t==null?void 0:t.operation)!=="set"&&i)return i;const n=this.model.$types()[e[this.model.$typeKey()]],o=h=>(n?n.newRawInstance():this.model).$newInstance(e,{relations:!1,...t||{},...h}),a=o();return s&&!this.getNewHydrated&&(t==null?void 0:t.operation)!=="set"&&this.hydratedDataCache.set(this.model.$entity()+s,a),s&&(t==null?void 0:t.action)==="update"&&this.hydratedDataCache.set(this.model.$entity()+s,o({operation:"get"})),a}}var zs=Object.defineProperty,js=(r,e,t)=>e in r?zs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qs=(r,e,t)=>(js(r,typeof e!="symbol"?e+"":e,t),t),Ls=(r,e,t)=>{if(!e.has(r))throw TypeError("Cannot "+t)},T=(r,e,t)=>(Ls(r,e,"read from private field"),t?t.call(r):e.get(r)),Ws=(r,e,t)=>{if(e.has(r))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(r):e.set(r,t)},qe,D;class ct{constructor(){qs(this,qe),Ws(this,D,new Map)}has(e){var t;return!!(T(this,D).has(e)&&((t=T(this,D).get(e))!=null&&t.deref()))}get(e){const t=T(this,D).get(e);if(!t)return;const s=t.deref();if(s)return s;T(this,D).delete(e)}set(e,t){return T(this,D).set(e,new WeakRef(t)),this}get size(){return T(this,D).size}clear(){T(this,D).clear()}delete(e){return T(this,D).delete(e),!1}forEach(e){for(const[t,s]of this)e(s,t,this)}*[(qe=Symbol.toStringTag,Symbol.iterator)](){for(const[e,t]of T(this,D)){const s=t.deref();if(!s){T(this,D).delete(e);continue}yield[e,s]}}*entries(){for(const[e,t]of this)yield[e,t]}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}}D=new WeakMap;const Bs=new ct,Us=new Map,De={model:{namespace:"",withMeta:!1,hidden:["_meta"],visible:["*"]},cache:{shared:!0,provider:ct}},O={...De};var Qs=Object.defineProperty,Js=(r,e,t)=>e in r?Qs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,H=(r,e,t)=>(Js(r,typeof e!="symbol"?e+"":e,t),t);class de{constructor(e,t){H(this,"database"),H(this,"model"),H(this,"pinia"),H(this,"queryCache"),H(this,"hydratedDataCache"),H(this,"use"),H(this,"config"),this.config=O,this.database=e,this.pinia=t,this.hydratedDataCache=Us}static setModel(e){return this.useModel=e,this}setConfig(e){this.config=e}initialize(e){return this.config.cache&&this.config.cache!==!0&&(this.queryCache=this.config.cache.shared?Bs:new this.config.cache.provider),e?(this.model=e.newRawInstance(),this):this.use||this.$self().useModel?(this.use=this.use??this.$self().useModel,this.model=this.use.newRawInstance(),this):this}$self(){return this.constructor}getModel(){return oe(!!this.model,["The model is not registered. Please define the model to be used at","`use` property of the repository class."]),this.model}piniaStore(){return at(this.model.$storeName(),this.model.$piniaOptions(),this.query())(this.pinia)}repo(e){return Ee(e)}query(){return new ae(this.database,this.getModel(),this.queryCache,this.hydratedDataCache,this.pinia)}cache(){return this.queryCache}where(e,t){return this.query().where(e,t)}orWhere(e,t){return this.query().orWhere(e,t)}whereHas(e,t=()=>{},s,i){return this.query().whereHas(e,t,s,i)}orWhereHas(e,t=()=>{},s,i){return this.query().orWhereHas(e,t,s,i)}has(e,t,s){return this.query().has(e,t,s)}orHas(e,t,s){return this.query().orHas(e,t,s)}doesntHave(e){return this.query().doesntHave(e)}orDoesntHave(e){return this.query().orDoesntHave(e)}whereDoesntHave(e,t=()=>{}){return this.query().whereDoesntHave(e,t)}orWhereDoesntHave(e,t=()=>{}){return this.query().orWhereDoesntHave(e,t)}withMeta(){return this.query().withMeta()}makeVisible(e){return this.query().makeVisible(e)}makeHidden(e){return this.query().makeHidden(e)}groupBy(...e){return this.query().groupBy(...e)}orderBy(e,t){return this.query().orderBy(e,t)}limit(e){return this.query().limit(e)}offset(e){return this.query().offset(e)}with(e,t){return this.query().with(e,t)}withAll(e){return this.query().withAll(e)}withAllRecursive(e){return this.query().withAllRecursive(e)}useCache(e,t){return this.query().useCache(e,t)}all(){return this.query().get()}find(e){return this.query().find(e)}revive(e){return this.query().revive(e)}make(e){return w(e)?e.map(t=>this.getModel().$newInstance(t,{relations:!0})):this.getModel().$newInstance(e,{relations:!0})}save(e){return this.query().save(e)}new(e=!0){return this.query().new(e)}insert(e){return this.query().insert(e)}fresh(e){return this.query().fresh(e)}destroy(e){return this.query().destroy(e)}flush(){return this.query().flush()}}H(de,"_isRepository",!0);H(de,"useModel");var Vs=Object.defineProperty,Gs=(r,e,t)=>e in r?Vs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ys=(r,e,t)=>(Gs(r,typeof e!="symbol"?e+"":e,t),t);class Xs{constructor(){Ys(this,"models",{})}register(e){const t=e.$entity();this.models[t]||(this.models[t]=e,this.registerRelatedModels(e))}registerRelatedModels(e){const t=e.$fields();for(const s in t){const i=t[s];i instanceof R&&i.getRelateds().forEach(n=>{this.register(n)})}}getModel(e){return this.models[e]}}const Zs=r=>r,lt=[];function ks(r){let e=O;return lt.forEach(t=>{const s=t({config:e,repository:r,model:r.getModel()});e={...e,...s.config}}),r.setConfig(e),r}function Ee(r,e){const t=new Xs,s=r._isRepository?new r(t,e).initialize():new de(t,e).initialize(r);try{const i=Object.values(s.getModel().$types());i.length>0?i.forEach(n=>s.database.register(n.newRawInstance())):s.database.register(s.getModel())}catch{}return ks(s)}function er(r){O.model={...De.model,...r==null?void 0:r.model},O.cache=(r==null?void 0:r.cache)===!1?!1:{...De.cache,...(r==null?void 0:r.cache)!==!0&&(r==null?void 0:r.cache)};const e={use(t){return lt.push(t),this}};return()=>e}let tr=class extends he{make(e){return e===void 0?this.value:e}},sr=class extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("string",e)}};class rr extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("number",e)}}class ir extends he{constructor(e,t){super(e,t)}make(e){return this.makeReturn("boolean",e)}}var nr=Object.defineProperty,or=(r,e,t)=>e in r?nr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Le=(r,e,t)=>(or(r,typeof e!="symbol"?e+"":e,t),t);class We extends R{constructor(e,t,s,i){super(e,t),Le(this,"foreignKey"),Le(this,"localKey"),this.foreignKey=s,this.localKey=i}getRelateds(){return[this.related]}define(e){return e.one(this.related,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,i)=>{t[s]=e[i]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,i)=>e.whereIn(s,this.getKeys(t,i)))}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.localKey)];i[o]?n.$setRelation(e,i[o][0]):n.$setRelation(e,null)})}buildDictionary(e){return this.mapToDictionary(e,t=>[t[this.getKey(this.foreignKey)],t])}make(e){return e?this.related.$newInstance(e):null}}var ar=Object.defineProperty,hr=(r,e,t)=>e in r?ar(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,be=(r,e,t)=>(hr(r,typeof e!="symbol"?e+"":e,t),t);let cr=class extends R{constructor(e,t,s,i){super(e,t),be(this,"child"),be(this,"foreignKey"),be(this,"ownerKey"),this.foreignKey=s,this.ownerKey=i,this.child=t}getRelateds(){return[this.child]}define(e){return e.one(this.child,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.ownerKey,(s,i)=>{e[s]=t[i]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.ownerKey,(s,i)=>e.whereIn(i,this.getEagerModelKeys(t,s)))}getEagerModelKeys(e,t){return e.reduce((s,i)=>(i[t]!==null&&s.push(i[t]),s),[])}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.foreignKey)];i[o]?n.$setRelation(e,i[o]):n.$setRelation(e,null)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.getKey(this.ownerKey)]]=s,t),{})}make(e){return e?this.child.$newInstance(e):null}};var lr=Object.defineProperty,ur=(r,e,t)=>e in r?lr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Be=(r,e,t)=>(ur(r,typeof e!="symbol"?e+"":e,t),t);let dr=class extends R{constructor(e,t,s,i){super(e,t),Be(this,"foreignKey"),Be(this,"localKey"),this.foreignKey=s,this.localKey=i}getRelateds(){return[this.related]}define(e){return e.many(this.related,this.parent)}attach(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,i)=>{t[s]=e[i]})}addEagerConstraints(e,t){this.compositeKeyMapper(this.foreignKey,this.localKey,(s,i)=>e.whereIn(s,this.getKeys(t,i)))}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.getKey(this.localKey)];i[o]?n.$setRelation(e,i[o]):n.$setRelation(e,[])})}buildDictionary(e){return this.mapToDictionary(e,t=>{const s=this.getKey(this.foreignKey);return[t[s],t]})}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}};var fr=Object.defineProperty,pr=(r,e,t)=>e in r?fr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ve=(r,e,t)=>(pr(r,typeof e!="symbol"?e+"":e,t),t);let yr=class extends R{constructor(e,t,s,i){super(e,t),ve(this,"child"),ve(this,"foreignKey"),ve(this,"ownerKey"),this.foreignKey=s,this.ownerKey=i,this.child=t}getRelateds(){return[this.child]}define(e){return e.many(this.child,this.parent)}attach(e,t){t[this.ownerKey]!==void 0&&(e[this.foreignKey]||(e[this.foreignKey]=[]),this.attachIfMissing(e[this.foreignKey],t[this.ownerKey]))}attachIfMissing(e,t){e.includes(t)||e.push(t)}addEagerConstraints(e,t){e.whereIn(this.ownerKey,this.getEagerModelKeys(t))}getEagerModelKeys(e){return e.reduce((t,s)=>[...t,...s[this.foreignKey]],[])}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=this.getRelatedModels(i,n[this.foreignKey]);n.$setRelation(e,o)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.ownerKey]]=s,t),{})}getRelatedModels(e,t){return t.reduce((s,i)=>{const n=e[i];return n&&s.push(n),s},[])}make(e){return e?e.map(t=>this.child.$newInstance(t)):[]}};var mr=Object.defineProperty,gr=(r,e,t)=>e in r?mr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_e=(r,e,t)=>(gr(r,typeof e!="symbol"?e+"":e,t),t);class Ue extends R{constructor(e,t,s,i,n){super(e,t),_e(this,"morphId"),_e(this,"morphType"),_e(this,"localKey"),this.morphId=s,this.morphType=i,this.localKey=n}getRelateds(){return[this.related]}define(e){return e.one(this.related,this.parent)}attach(e,t){t[this.morphId]=e[this.localKey],t[this.morphType]=this.parent.$entity()}addEagerConstraints(e,t){e.where(this.morphType,this.parent.$entity()).whereIn(this.morphId,this.getKeys(t,this.localKey))}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.localKey];i[o]?n.$setRelation(e,i[o]):n.$setRelation(e,null)})}buildDictionary(e){return e.reduce((t,s)=>(t[s[this.morphId]]=s,t),{})}make(e){return e?this.related.$newInstance(e):null}}var $r=Object.defineProperty,wr=(r,e,t)=>e in r?$r(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ie=(r,e,t)=>(wr(r,typeof e!="symbol"?e+"":e,t),t);class br extends R{constructor(e,t,s,i,n){super(e,t),Ie(this,"morphId"),Ie(this,"morphType"),Ie(this,"localKey"),this.morphId=s,this.morphType=i,this.localKey=n}getRelateds(){return[this.related]}define(e){return e.many(this.related,this.parent)}attach(e,t){t[this.morphId]=e[this.localKey],t[this.morphType]=this.parent.$entity()}addEagerConstraints(e,t){e.where(this.morphType,this.parent.$entity()),e.whereIn(this.morphId,this.getKeys(t,this.localKey))}match(e,t,s){const i=this.buildDictionary(s.get(!1));t.forEach(n=>{const o=n[this.localKey];i[o]?n.$setRelation(e,i[o]):n.$setRelation(e,[])})}buildDictionary(e){return this.mapToDictionary(e,t=>[t[this.morphId],t])}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}}var vr=Object.defineProperty,_r=(r,e,t)=>e in r?vr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ee=(r,e,t)=>(_r(r,typeof e!="symbol"?e+"":e,t),t);class Ir extends R{constructor(e,t,s,i,n,o,a){super(e,t),ee(this,"through"),ee(this,"firstKey"),ee(this,"secondKey"),ee(this,"localKey"),ee(this,"secondLocalKey"),this.through=s,this.firstKey=i,this.secondKey=n,this.localKey=o,this.secondLocalKey=a}getRelateds(){return[this.related,this.through]}define(e){return e.many(this.related,this.parent)}attach(e,t){}addEagerConstraints(e,t){}match(e,t,s){const i=s.newQuery(this.through.$entity()).where(this.firstKey,this.getKeys(t,this.localKey)).get(!1),n=s.where(this.secondKey,this.getKeys(i,this.secondLocalKey)).groupBy(this.secondKey).get(!1),o=this.buildDictionary(i,n);t.forEach(a=>{const h=a[this.localKey];o[h]?a.$setRelation(e,o[h][0]):a.$setRelation(e,[])})}buildDictionary(e,t){return this.mapToDictionary(e,s=>[s[this.firstKey],t[s[this.secondLocalKey]]])}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}}var Rr=Object.defineProperty,Kr=(r,e,t)=>e in r?Rr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e,t)=>(Kr(r,typeof e!="symbol"?e+"":e,t),t);class Pr extends R{constructor(e,t,s,i,n,o,a,h){super(e,t),W(this,"pivot"),W(this,"morphId"),W(this,"morphType"),W(this,"relatedId"),W(this,"parentKey"),W(this,"relatedKey"),W(this,"pivotKey","pivot"),this.pivot=s,this.morphId=n,this.morphType=o,this.relatedId=i,this.parentKey=a,this.relatedKey=h}getRelateds(){return[this.related,this.pivot]}define(e){return e.many(this.related,this.parent)}attach(e,t){const s=t.pivot??{};s[this.morphId]=e[this.parentKey],s[this.morphType]=this.parent.$entity(),s[this.relatedId]=t[this.relatedKey],t[`pivot_${this.pivot.$entity()}`]=s}make(e){return e?e.map(t=>this.related.$newInstance(t)):[]}match(e,t,s){const i=s.get(!1),n=s.newQuery(this.pivot.$entity()).whereIn(this.relatedId,this.getKeys(i,this.relatedKey)).whereIn(this.morphId,this.getKeys(t,this.parentKey)).groupBy(this.morphId,this.relatedId,this.morphType).get();t.forEach(o=>{const a=[];i.forEach(h=>{var d;const c=((d=n[`[${o[this.parentKey]},${h[this.relatedKey]},${this.parent.$entity()}]`])==null?void 0:d[0])??null,u=h.$newInstance(h.$toJson());u.$setRelation("pivot",c),c&&a.push(u)}),o.$setRelation(e,a)})}addEagerConstraints(e,t){}}var Cr=Object.defineProperty,Or=(r,e,t)=>e in r?Cr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,b=(r,e,t)=>(Or(r,typeof e!="symbol"?e+"":e,t),t);class y{constructor(e,t={operation:"set"}){this.$boot(),(t.fill??!0)&&this.$fill(e,t)}static fields(){return{}}static initializeSchema(){this.schemas[this.entity]={},this.fieldsOnDelete[this.entity]=this.fieldsOnDelete[this.entity]??{};const e={...this.fields(),...this.registries[this.entity]};for(const t in e){const s=e[t];this.schemas[this.entity][t]=typeof s=="function"?s():s,this.fieldsOnDelete[this.entity][t]&&(this.schemas[this.entity][t]=this.schemas[this.entity][t].onDelete(this.fieldsOnDelete[this.entity][t]))}}static setRegistry(e,t){return this.registries[this.entity]||(this.registries[this.entity]={}),this.registries[this.entity][e]=t,this}static setFieldDeleteMode(e,t){return this.fieldsOnDelete[this.entity]=this.fieldsOnDelete[this.entity]??{},this.fieldsOnDelete[this.entity][e]=t,this}static setMutator(e,t){return this.fieldMutators[e]=t,this}static setCast(e,t){return this.fieldCasts[e]=t,this}static setHidden(e){return this.hidden.push(e),this}static clearBootedModels(){this.booted={},this.original={},this.schemas={},this.fieldMutators={},this.fieldCasts={},this.hidden=[],this.visible=[]}static clearRegistries(){this.registries={}}static newRawInstance(){return new this(void 0,{fill:!1})}static attr(e){return new tr(this.newRawInstance(),e)}static string(e){return new sr(this.newRawInstance(),e)}static number(e){return new rr(this.newRawInstance(),e)}static boolean(e){return new ir(this.newRawInstance(),e)}static uid(e){return new ot(this.newRawInstance(),e)}static hasOne(e,t,s){const i=this.newRawInstance();return s=s??i.$getKeyName(),new We(i,e.newRawInstance(),t,s)}static belongsTo(e,t,s){const i=e.newRawInstance();return s=s??i.$getKeyName(),new cr(this.newRawInstance(),i,t,s)}static belongsToMany(e,t,s,i,n,o){const a=e.newRawInstance(),h=this.newRawInstance(),c=t.newRawInstance();return n=n??h.$getLocalKey(),o=o??a.$getLocalKey(),this.schemas[e.entity][`pivot_${c.$entity()}`]=new We(a,c,i,o),new ht(h,a,c,s,i,n,o)}static morphToMany(e,t,s,i,n,o,a){const h=e.newRawInstance(),c=this.newRawInstance(),u=t.newRawInstance();return o=o??c.$getLocalKey(),a=a??h.$getLocalKey(),this.schemas[e.entity][`pivot_${u.$entity()}`]=new Ue(h,u,s,c.$entity(),a),new Pr(c,h,u,s,i,n,o,a)}static hasMany(e,t,s){const i=this.newRawInstance();return s=s??i.$getKeyName(),new dr(i,e.newRawInstance(),t,s)}static hasManyBy(e,t,s){const i=e.newRawInstance();return s=s??i.$getLocalKey(),new yr(this.newRawInstance(),i,t,s)}static hasManyThrough(e,t,s,i,n,o){const a=this.newRawInstance(),h=t.newRawInstance();return n=n??a.$getLocalKey(),o=o??h.$getLocalKey(),new Ir(a,e.newRawInstance(),h,s,i,n,o)}static morphOne(e,t,s,i){const n=this.newRawInstance();return i=i??n.$getLocalKey(),new Ue(n,e.newRawInstance(),t,s,i)}static morphTo(e,t,s,i=""){const n=this.newRawInstance(),o=e.map(a=>a.newRawInstance());return new Se(n,o,t,s,i)}static morphMany(e,t,s,i){const n=this.newRawInstance();return i=i??n.$getLocalKey(),new br(n,e.newRawInstance(),t,s,i)}static mutators(){return{}}static casts(){return{}}static types(){return{}}$self(){return this.constructor}$entity(){return this.$self().entity}$config(){return this.$self().config}$namespace(){return this.$self().namespace??O.model.namespace}$storeName(){return(this.$namespace()?this.$namespace()+"/":"")+this.$baseEntity()}$baseEntity(){return this.$self().baseEntity??this.$entity()}$typeKey(){return this.$self().typeKey}$types(){return this.$self().types()}$piniaOptions(){return this.$self().piniaOptions}$primaryKey(){return this.$self().primaryKey}$fields(){return this.$self().schemas[this.$entity()]}$hidden(){return this.$self().hidden}$visible(){return this.$self().visible}$newInstance(e,t){const s=this.$self();return new s(e,t)}$boot(){this.$self().booted[this.$entity()]||(this.$self().booted[this.$entity()]=!0,this.$initializeSchema())}$initializeSchema(){this.$self().initializeSchema()}$casts(){return{...this.$getCasts(),...this.$self().fieldCasts}}$fill(e={},t={}){var h;const s=t.operation??"get",i={...O.model,...this.$config()};i.withMeta&&(this.$self().schemas[this.$entity()][this.$self().metaKey]=this.$self().attr({}));const n=this.$fields(),o=t.relations??!0,a={...this.$getMutators(),...this.$self().fieldMutators};for(const c in n){if(s==="get"&&!this.isFieldVisible(c,this.$hidden(),this.$visible(),t))continue;const u=n[c];let d=e[c];if(u instanceof R&&!o)continue;const I=a==null?void 0:a[c],m=(h=this.$casts()[c])==null?void 0:h.newRawInstance(n);I&&s==="get"&&(d=typeof I=="function"?I(d):typeof I.get=="function"?I.get(d):d),m&&s==="get"&&(d=m.get(d));let l=this.$fillField(c,u,d);I&&typeof I!="function"&&s==="set"&&I.set&&(l=I.set(l)),m&&s==="set"&&(l=m.set(l)),this[c]=this[c]??l}return s==="set"&&(this.$self().original[this.$getKey(this,!0)]=this.$getAttributes()),i.withMeta&&s==="set"&&this.$fillMeta(t.action),this}$fillMeta(e="save"){const t=Math.floor(Date.now()/1e3);e==="save"&&(this[this.$self().metaKey]={createdAt:t,updatedAt:t}),e==="update"&&(this[this.$self().metaKey].updatedAt=t)}$fillField(e,t,s){if(s!==void 0)return t instanceof Se?t.setKey(e).make(s,this[t.getType()]):t.setKey(e).make(s);if(this[e]===void 0)return t.setKey(e).make()}isFieldVisible(e,t,s,i){const n=t.length>0?t:O.model.hidden,o=[...s.length>0?s:O.model.visible,String(this.$primaryKey())],a=i.visible??[],h=i.hidden??[];return(n.includes("*")||n.includes(e))&&!a.includes(e)||h.includes(e)?!1:(o.includes("*")||o.includes(e))&&!h.includes(e)||a.includes(e)}$getKeyName(){return this.$primaryKey()}$getKey(e,t=!1){if(e=e??this,this.$hasCompositeKey()){const i=this.$getCompositeKey(e);return t?"["+(i==null?void 0:i.join(","))+"]":i}const s=e[this.$getKeyName()];return Oe(s)?null:s}$hasCompositeKey(){return w(this.$getKeyName())}$getCompositeKey(e){let t=[];return this.$getKeyName().every(s=>{const i=e[s];return Oe(i)?(t=null,!1):(t.push(i),!0)}),t===null?null:t}$getIndexId(e){const t=e??this,s=this.$getKey(t);return oe(s!==null,["The record is missing the primary key. If you want to persist record","without the primary key, please define the primary key field with the","`uid` attribute."]),this.$stringifyId(s)}$stringifyId(e){return w(e)?JSON.stringify(e):String(e)}$getLocalKey(){return oe(!this.$hasCompositeKey(),["Please provide the local key for the relationship. The model with the","composite key can't infer its local key."]),this.$getKeyName()}$getRelation(e){let t=this.$fields()[e];return Object.values(this.$types()).forEach(i=>{t===void 0&&(t=i.fields()[e])}),oe(t instanceof R,[`Relationship [${e}] on model [${this.$entity()}] not found.`]),t}$setRelation(e,t){return e.includes("pivot")?(this.pivot=t,this):(this.$fields()[e]&&(this[e]=t),this)}$getMutators(){return this.$self().mutators()}$getCasts(){return this.$self().casts()}$getOriginal(){return this.$self().original[this.$getKey(this,!0)]}$refresh(){return this.$isDirty()&&Object.entries(this.$getOriginal()).forEach(e=>{this[e[0]]=e[1]}),this}$isDirty(e){const t=this.$getOriginal();return e?(Object.keys(t).includes(e)||ue(['The property"',e,'"does not exit in the model "',this.$entity(),'"']),!Me(this[e],t[e])):!Me(t,this.$getAttributes())}$getAttributes(){return this.$toJson(this,{relations:!1})}$toJson(e,t={}){e=e??this;const s=e.$fields(),i=t.relations??!0,n={};for(const o in s){const a=s[o],h=e[o];if(!(a instanceof R)){n[o]=this.serializeValue(h);continue}i&&(n[o]=this.serializeRelation(h))}return n}serializeValue(e){return e===null?null:w(e)?this.serializeArray(e):typeof e=="object"?e instanceof Date&&!isNaN(e.getTime())&&typeof e.toISOString=="function"?e.toISOString():this.serializeObject(e):e}serializeArray(e){return e.map(t=>this.serializeValue(t))}serializeObject(e){const t={};for(const s in e)t[s]=this.serializeValue(e[s]);return t}serializeRelation(e){if(e!==void 0)return e===null?null:w(e)?e.map(t=>t.$toJson()):e.$toJson()}}b(y,"entity");b(y,"baseEntity");b(y,"namespace");b(y,"primaryKey","id");b(y,"metaKey","_meta");b(y,"hidden",["_meta"]);b(y,"visible",[]);b(y,"config");b(y,"typeKey","type");b(y,"fieldsOnDelete",{});b(y,"original",{});b(y,"schemas",{});b(y,"registries",{});b(y,"piniaOptions",{});b(y,"fieldMutators",{});b(y,"fieldCasts",{});b(y,"booted",{});b(y,"saving",()=>{});b(y,"updating",()=>{});b(y,"creating",()=>{});b(y,"deleting",()=>{});b(y,"retrieved",()=>{});b(y,"saved",()=>{});b(y,"updated",()=>{});b(y,"created",()=>{});b(y,"deleted",()=>{});var Mr=Object.defineProperty,xr=(r,e,t)=>e in r?Mr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,te=(r,e,t)=>(xr(r,typeof e!="symbol"?e+"":e,t),t);class Sr{constructor(e,t,s){te(this,"repository"),te(this,"config"),te(this,"response"),te(this,"entities",null),te(this,"isSaved",!1),this.repository=e,this.config=t,this.response=s}async save(){const e=this.getDataFromResponse();if(!this.validateData(e)){console.warn("[Pinia ORM Axios] The response data could not be saved to the store because it is not an object or an array. You might want to use `dataTransformer` option to handle non-array/object response before saving it to the store.");return}let t=this.config.persistBy||"save";this.validatePersistAction(t)||(console.warn('[Pinia ORM Axios] The "persistBy" option configured is not a recognized value. Response data will be persisted by the default `save` method.'),t="save");const s=await this.repository[t](e);this.entities=Array.isArray(s)?s:[s],this.isSaved=!0}async delete(){if(this.config.delete===void 0)throw new Error("[Pinia ORM Axios] Could not delete records because the `delete` option is not set.");await this.repository.query().destroy(this.config.delete)}getDataFromResponse(){return this.config.dataTransformer?this.config.dataTransformer(this.response):this.config.dataKey?this.response.data[this.config.dataKey]:this.response.data}validateData(e){return e!==null&&typeof e=="object"}validatePersistAction(e){return["save","insert"].includes(e)}}var Dr=Object.defineProperty,Er=(r,e,t)=>e in r?Dr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qe=(r,e,t)=>(Er(r,typeof e!="symbol"?e+"":e,t),t);class Ar{constructor(e){Qe(this,"repository"),Qe(this,"config",{save:!0}),this.repository=e,this.registerActions()}get axios(){if(!this.repository.axios)throw new Error("[Pinia ORM Axios] The axios instance is not registered. Please register the axios instance to the repository.");return this.repository.axios}registerActions(){var t,s,i;const e={...(t=this.repository.config.axiosApi)==null?void 0:t.actions,...(i=(s=this.repository.getModel().$config())==null?void 0:s.axiosApi)==null?void 0:i.actions};if(e)for(const n in e){const o=e[n];typeof o=="function"?this.registerFunctionAction(n,o):this.registerObjectAction(n,o)}}registerObjectAction(e,t){this[e]=s=>this.request({...t,...s})}registerFunctionAction(e,t){this[e]=t.bind(this)}get(e,t={}){return this.request({method:"get",url:e,...t})}post(e,t={},s={}){return this.request({method:"post",url:e,data:t,...s})}put(e,t={},s={}){return this.request({method:"put",url:e,data:t,...s})}patch(e,t={},s={}){return this.request({method:"patch",url:e,data:t,...s})}delete(e,t={}){return this.request({method:"delete",url:e,...t})}async request(e){const t=this.createConfig(e),s=await this.axios.request(t);return this.createResponse(s,t)}createConfig(e){return{...this.config,...this.repository.globalApiConfig,...this.repository.apiConfig,...e}}async createResponse(e,t){const s=new Sr(this.repository,t,e);return t.delete!==void 0?(await s.delete(),s):(t.save&&await s.save(),s)}}var Nr=Object.defineProperty,Tr=(r,e,t)=>e in r?Nr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Re=(r,e,t)=>(Tr(r,typeof e!="symbol"?e+"":e,t),t);class ut extends de{constructor(){var e;super(...arguments),Re(this,"axios",((e=O==null?void 0:O.axiosApi)==null?void 0:e.axios)||null),Re(this,"globalApiConfig",(O==null?void 0:O.axiosApi)||{}),Re(this,"apiConfig",{})}api(){return Fr(this)}setAxios(e){return this.axios=e,this}}function Fr(r){return new Ar(r)}function Hr(r){return Zs(e=>(e.config.axiosApi=r,e))}const zr=Ut(),dt=er();dt().use(Hr({axios:window.axios,baseURL:window.SupportChat.path+"/api/v1",dataKey:"data"}));const jr=zr.use(dt);function F(r){return(e,t)=>{const s=e.$self();s.setRegistry(t,()=>s.attr(r))}}function K(r,e={}){return(t,s)=>{const i=t.$self();i.setRegistry(s,()=>{const n=i.string(r);return e.notNullable&&n.notNullable(),n})}}function fe(r,e={}){return(t,s)=>{const i=t.$self();i.setRegistry(s,()=>{const n=i.number(r);return e.notNullable&&n.notNullable(),n})}}function z(r,e={}){return(t,s)=>{const i=t.$self();i.setRegistry(s,()=>{const n=i.boolean(r);return e.notNullable&&n.notNullable(),n})}}function ft(r){return(e,t)=>{const s=e.$self();s.setRegistry(t,()=>s.uid(r))}}function pe(r,e,t){return(s,i)=>{const n=s.$self();n.setRegistry(i,()=>n.belongsTo(r(),e,t))}}function pt(r,e,t,s,i,n){return(o,a)=>{const h=o.$self();h.setRegistry(a,()=>h.belongsToMany(r(),e(),t,s,i,n))}}function ye(r,e,t){return(s,i)=>{const n=s.$self();n.setRegistry(i,()=>n.hasMany(r(),e,t))}}function qr(r,e,t){return(s,i)=>{const n=s.$self();n.setRegistry(i,()=>n.hasManyBy(r(),e,t))}}var Lr=Object.defineProperty,Wr=Object.getOwnPropertyDescriptor,yt=(r,e,t,s)=>{for(var i=s>1?void 0:s?Wr(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Lr(e,t,i),i};class J extends y{}f(J,"entity","roomUser"),f(J,"primaryKey",["roomId","userId"]);yt([F()],J.prototype,"roomId",2);yt([F()],J.prototype,"userId",2);var Br=Object.defineProperty,Ur=Object.getOwnPropertyDescriptor,x=(r,e,t,s)=>{for(var i=s>1?void 0:s?Ur(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Br(e,t,i),i};class C extends y{}f(C,"entity","messageFiles"),f(C,"primaryKey",["messageId","name"]);x([K("")],C.prototype,"messageId",2);x([K("")],C.prototype,"name",2);x([K("")],C.prototype,"type",2);x([K("")],C.prototype,"extension",2);x([K("")],C.prototype,"url",2);x([K(null)],C.prototype,"localUrl",2);x([K(null)],C.prototype,"preview",2);x([fe(null)],C.prototype,"size",2);x([z(null)],C.prototype,"audio",2);x([fe(null)],C.prototype,"duration",2);x([fe(null)],C.prototype,"progress",2);x([F()],C.prototype,"blob",2);x([pe(()=>p,"messageId")],C.prototype,"message",2);var Qr=Object.defineProperty,Jr=Object.getOwnPropertyDescriptor,v=(r,e,t,s)=>{for(var i=s>1?void 0:s?Jr(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Qr(e,t,i),i};class p extends y{get id(){return this.indexId??this._id}}f(p,"entity","messages"),f(p,"primaryKey","_id");v([ft(7)],p.prototype,"_id",2);v([F()],p.prototype,"roomId",2);v([K(window.SupportChat.userId)],p.prototype,"senderId",2);v([K(null)],p.prototype,"replyMessageId",2);v([F(null)],p.prototype,"indexId",2);v([K(null)],p.prototype,"content",2);v([K(null)],p.prototype,"username",2);v([K(null)],p.prototype,"avatar",2);v([K(null)],p.prototype,"date",2);v([K(null)],p.prototype,"timestamp",2);v([z(null)],p.prototype,"system",2);v([z(null)],p.prototype,"saved",2);v([z(null)],p.prototype,"distributed",2);v([z(null)],p.prototype,"seen",2);v([z(null)],p.prototype,"deleted",2);v([z(null)],p.prototype,"failure",2);v([z(null)],p.prototype,"disableActions",2);v([z(null)],p.prototype,"disableReactions",2);v([F({})],p.prototype,"reactions",2);v([pe(()=>M,"roomId")],p.prototype,"room",2);v([pe(()=>E,"senderId")],p.prototype,"sender",2);v([ye(()=>C,"messageId")],p.prototype,"files",2);v([pe(()=>p,"replyMessageId")],p.prototype,"replyMessage",2);v([ye(()=>p,"replyMessageId")],p.prototype,"replies",2);var Vr=Object.defineProperty,Gr=Object.getOwnPropertyDescriptor,V=(r,e,t,s)=>{for(var i=s>1?void 0:s?Gr(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Vr(e,t,i),i};class E extends y{}f(E,"entity","users"),f(E,"primaryKey","_id");V([F()],E.prototype,"_id",2);V([K("")],E.prototype,"username",2);V([K("")],E.prototype,"avatar",2);V([F()],E.prototype,"status",2);V([pt(()=>M,()=>J,"userId","roomId")],E.prototype,"rooms",2);V([ye(()=>p,"senderId")],E.prototype,"messages",2);var Yr=Object.defineProperty,Xr=Object.getOwnPropertyDescriptor,j=(r,e,t,s)=>{for(var i=s>1?void 0:s?Xr(e,t):e,n=r.length-1,o;n>=0;n--)(o=r[n])&&(i=(s?o(e,t,i):o(i))||i);return s&&i&&Yr(e,t,i),i};class M extends y{}f(M,"entity","rooms"),f(M,"primaryKey","roomId");j([ft(7)],M.prototype,"roomId",2);j([K("")],M.prototype,"roomName",2);j([K("")],M.prototype,"avatar",2);j([fe(null)],M.prototype,"unreadCount",2);j([F(null)],M.prototype,"index",2);j([F(null)],M.prototype,"typingUsers",2);j([pt(()=>E,()=>J,"roomId","userId")],M.prototype,"users",2);j([qr(()=>E,"typingUsers")],M.prototype,"usersTyping",2);j([ye(()=>p,"roomId")],M.prototype,"messages",2);class Zr extends ut{constructor(){super(...arguments);f(this,"use",M);f(this,"loaded",!1);f(this,"fetch",async()=>{this.loaded=!1;const t=await this.api().get("/rooms");return this.loaded=!0,t});f(this,"add",async()=>{const{roomId:t}=this.new();return await this.api().post("/rooms",{id:t})});f(this,"delete",async t=>await this.api().delete(`/rooms/${t}`,{delete:1}));f(this,"setUsers",(t,s)=>{this.query().whereId(t).update({users:s})});f(this,"joinUser",(t,s)=>{var n;const i=((n=this.find(t))==null?void 0:n.users)??[];this.query().whereId(t).update({users:[...i,s]})});f(this,"leaveUser",(t,s)=>{var o;const n=(((o=this.find(t))==null?void 0:o.users)??[]).filter(a=>a._id!==s._id);this.query().whereId(t).update({users:n})});f(this,"messagePosted",(t,s)=>{})}joined(){return this.with("users",t=>{t.whereId(window.SupportChat.userId)})}}const se=window.SupportChat.path+"/api/v1",kr={index(){return window.axios.get(se+"/rooms")},store(r){return window.axios.post(se+"/rooms",r)},show(r){return window.axios.get(se+"/rooms/"+r)},update(r,e){return window.axios.put(se+"/rooms/"+r,e)},destroy(r){return window.axios.delete(se+"/rooms/"+r)}},re=window.SupportChat.path+"/api/v1",ei={index(r){return window.axios.get(`${re}/rooms/${r}/messages`)},store(r,e){return window.axios.post(`${re}/rooms/${r}/messages`,e)},show(r){return window.axios.get(`${re}/messages/${r}`)},update(r,e){return window.axios.put(`${re}/messages/${r}`,e)},destroy(r){return window.axios.delete(`${re}/messages/${r}`)}},Je=window.SupportChat.path+"/api/v1",ti={store(r,e){return window.axios.post(`${Je}/messages/${r}/reactions`,e,{headers:{"Content-Type":"text/plain"}})},destroy(r,e){return window.axios.delete(`${Je}/messages/${r}/reactions/${e}`)}},Ke=window.SupportChat.path+"/api/v1",si={store(r,e,t){return window.axios.post(`${Ke}/messages/${r}/attachments`,e,t)},show(r,e){return window.axios.get(`${Ke}/messages/${r}/attachments/${e}`)},destroy(r,e){return window.axios.delete(`${Ke}/messages/${r}/attachments/${e}`)}},Ve={rooms:kr,messages:ei,messageReactions:ti,attachments:si};class ri extends ut{constructor(){super(...arguments);f(this,"use",p);f(this,"loaded",!1);f(this,"fetch",async({room:t})=>{this.loaded=!1;const s=await this.api().get(`/rooms/${t.roomId}/messages`);return this.loaded=!0,s});f(this,"send",async({roomId:t,content:s,files:i,replyMessage:n})=>{const{_id:o}=this.init({content:s,replyMessage:n,files:i});return await this.trySend({roomId:t,message:{_id:o,content:s,replyMessage:n,files:i}})});f(this,"trySend",async({roomId:t,message:s})=>{var i,n;try{return await this.api().post(`/rooms/${t}/messages`,{id:s._id,parent_id:(i=s.replyMessage)==null?void 0:i._id,content:s.content,attachments:((n=s.files)==null?void 0:n.map(o=>({name:o.name+"."+o.extension,type:o.type,size:o.size})))??[]})}catch(o){throw this.where("_id",s._id).update({failure:!0}),o}});f(this,"edit",async({messageId:t,newContent:s,replyMessage:i})=>{});f(this,"delete",async({message:t})=>await this.api().delete(`/messages/${t._id}`,{delete:1}));f(this,"sendReaction",async({messageId:t,reaction:s,remove:i})=>{i?(this.reactionRemoved({messageId:t,userId:window.SupportChat.userId,emoji:s.unicode}),await Ve.messageReactions.destroy(t,s.unicode)):(this.reactionLeft({messageId:t,userId:window.SupportChat.userId,emoji:s.unicode}),await Ve.messageReactions.store(t,s.unicode))});f(this,"posted",(t,s)=>this.save({...s,roomId:t}));f(this,"edited",t=>this.save(t));f(this,"deleted",t=>this.save({...t,deleted:!0}));f(this,"reactionLeft",({messageId:t,userId:s,emoji:i})=>{const n=this.find(t).reactions;return n[i]=[...new Set(n[i]).add(s)],this.query().whereId(t).update({reactions:n})});f(this,"reactionRemoved",({messageId:t,userId:s,emoji:i})=>{const n=this.find(t).reactions,o=new Set(n[i]);return o.delete(s),n[i]=[...o],this.query().whereId(t).update({reactions:n})})}init({content:t,replyMessage:s,files:i}){return this.save({content:t,files:(i||[]).map(n=>({name:n.name,type:n.type,extension:n.extension,url:n.localURL,localUrl:n.localURL,preview:"",size:n.size,audio:!1,duration:0,progress:0,blob:n.blob})),replyMessage:s})}}const ii="/vendor/support-chat/build/assets/favicon-fd34bfbb.svg",ni=["height","current-user-id",".rooms","rooms-loaded",".messages","messages-loaded",".room-actions",".menu-actions"],oi=Et({__name:"SupportChat",setup(r){Lt();const e=ie(),t={x:"center",y:"center",minwidth:250,minheight:400,icon:ii,title:"Support Chat",class:"modern"},s=ie("600px"),i=Q(()=>Ee(Zr)),n=Q(()=>Ee(ri)),o=Q(()=>i.value.all()),a=Q(()=>i.value.joined().get()),h=Q(()=>n.value.all()),c=ie([{name:"deleteRoom",title:"Delete Room"}]);At(async()=>{await i.value.fetch();for(const m of a.value)window.roomChannel=window.Echo.join(`support-chat.room.${m.roomId}`),window.roomChannel.here(l=>i.value.setUsers(m.roomId,l)).joining(l=>i.value.joinUser(m.roomId,l)).leaving(l=>i.value.leaveUser(m.roomId,l)).listenToAll((l,g)=>console.log(l,g)).error(l=>console.error(l)).listen(".message.posted",l=>n.value.posted(m.roomId,l)).listen(".message.edited",l=>n.value.edited(l)).listen(".message.deleted",l=>n.value.deleted(l)).listen(".reaction.left",l=>n.value.reactionLeft(l)).listen(".reaction.removed",l=>n.value.reactionRemoved(l))});function u(m){window.location.assign(m.file.file.url)}function d({roomId:m,action:l}){switch(l.name){case"deleteRoom":i.value.delete(m)}}function I(m){s.value=m.height-35+"px"}return(m,l)=>(Te(),Nt(Ft(jt),{ref_key:"wbRef",ref:e,options:t,onResize:I},{default:Tt(()=>[m.$env.userId?(Te(),Ht("vue-advanced-chat",{key:0,height:s.value,"current-user-id":m.$env.userId,".rooms":o.value,"rooms-loaded":i.value.loaded,"room-info-enabled":!1,".messages":h.value,"messages-loaded":n.value.loaded,".room-actions":c.value,".menu-actions":c.value,onFetchMessages:l[0]||(l[0]=g=>n.value.fetch(g.detail[0])),onFetchMoreRooms:l[1]||(l[1]=(...g)=>i.value.fetch&&i.value.fetch(...g)),onSendMessage:l[2]||(l[2]=g=>n.value.send(g.detail[0])),onEditMessage:l[3]||(l[3]=g=>n.value.edit(g.detail[0])),onDeleteMessage:l[4]||(l[4]=g=>n.value.delete(g.detail[0])),onOpenFile:l[5]||(l[5]=g=>u(g.detail[0])),onOpenFailedMessage:l[6]||(l[6]=g=>n.value.trySend(g.detail[0])),onAddRoom:l[7]||(l[7]=(...g)=>i.value.add&&i.value.add(...g)),onRoomActionHandler:l[8]||(l[8]=g=>d(g.detail[0])),onMenuActionHandler:l[9]||(l[9]=g=>d(g.detail[0])),onSendMessageReaction:l[10]||(l[10]=g=>n.value.sendReaction(g.detail[0]))},null,40,ni)):zt("",!0)]),_:1},512))}});qt({}).component("support-chat",oi).use(Wt).use(jr).mount("#support-chat");
